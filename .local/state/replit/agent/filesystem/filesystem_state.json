{"file_contents":{"components/ErrorFallback.tsx":{"content":"import React, { useState } from \"react\";\nimport { reloadAppAsync } from \"expo\";\nimport {\n  StyleSheet,\n  View,\n  Pressable,\n  ScrollView,\n  Text,\n  Modal,\n  useColorScheme,\n  Platform,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Feather } from \"@expo/vector-icons\";\n\nexport type ErrorFallbackProps = {\n  error: Error;\n  resetError: () => void;\n};\n\nexport function ErrorFallback({ error, resetError }: ErrorFallbackProps) {\n  const colorScheme = useColorScheme();\n  const isDark = colorScheme === \"dark\";\n  const insets = useSafeAreaInsets();\n\n  const theme = {\n    background: isDark ? \"#000000\" : \"#FFFFFF\",\n    backgroundSecondary: isDark ? \"#1C1C1E\" : \"#F2F2F7\",\n    text: isDark ? \"#FFFFFF\" : \"#000000\",\n    textSecondary: isDark ? \"rgba(255, 255, 255, 0.7)\" : \"rgba(0, 0, 0, 0.7)\",\n    link: \"#007AFF\",\n    buttonText: \"#FFFFFF\",\n  };\n\n  const [isModalVisible, setIsModalVisible] = useState(false);\n\n  const handleRestart = async () => {\n    try {\n      await reloadAppAsync();\n    } catch (restartError) {\n      console.error(\"Failed to restart app:\", restartError);\n      resetError();\n    }\n  };\n\n  const formatErrorDetails = (): string => {\n    let details = `Error: ${error.message}\\n\\n`;\n    if (error.stack) {\n      details += `Stack Trace:\\n${error.stack}`;\n    }\n    return details;\n  };\n\n  const monoFont = Platform.select({\n    ios: \"Menlo\",\n    android: \"monospace\",\n    default: \"monospace\",\n  });\n\n  return (\n    <View style={[styles.container, { backgroundColor: theme.background }]}>\n      {__DEV__ ? (\n        <Pressable\n          onPress={() => setIsModalVisible(true)}\n          accessibilityLabel=\"View error details\"\n          accessibilityRole=\"button\"\n          style={({ pressed }) => [\n            styles.topButton,\n            {\n              top: insets.top + 16,\n              backgroundColor: theme.backgroundSecondary,\n              opacity: pressed ? 0.8 : 1,\n            },\n          ]}\n        >\n          <Feather name=\"alert-circle\" size={20} color={theme.text} />\n        </Pressable>\n      ) : null}\n\n      <View style={styles.content}>\n        <Text style={[styles.title, { color: theme.text }]}>\n          Something went wrong\n        </Text>\n\n        <Text style={[styles.message, { color: theme.textSecondary }]}>\n          Please reload the app to continue.\n        </Text>\n\n        <Pressable\n          onPress={handleRestart}\n          style={({ pressed }) => [\n            styles.button,\n            {\n              backgroundColor: theme.link,\n              opacity: pressed ? 0.9 : 1,\n              transform: [{ scale: pressed ? 0.98 : 1 }],\n            },\n          ]}\n        >\n          <Text style={[styles.buttonText, { color: theme.buttonText }]}>\n            Try Again\n          </Text>\n        </Pressable>\n      </View>\n\n      {__DEV__ ? (\n        <Modal\n          visible={isModalVisible}\n          animationType=\"slide\"\n          transparent={true}\n          onRequestClose={() => setIsModalVisible(false)}\n        >\n          <View style={styles.modalOverlay}>\n            <View\n              style={[\n                styles.modalContainer,\n                { backgroundColor: theme.background },\n              ]}\n            >\n              <View\n                style={[\n                  styles.modalHeader,\n                  {\n                    borderBottomColor: isDark\n                      ? \"rgba(255, 255, 255, 0.1)\"\n                      : \"rgba(0, 0, 0, 0.1)\",\n                  },\n                ]}\n              >\n                <Text style={[styles.modalTitle, { color: theme.text }]}>\n                  Error Details\n                </Text>\n                <Pressable\n                  onPress={() => setIsModalVisible(false)}\n                  accessibilityLabel=\"Close error details\"\n                  accessibilityRole=\"button\"\n                  style={({ pressed }) => [\n                    styles.closeButton,\n                    { opacity: pressed ? 0.6 : 1 },\n                  ]}\n                >\n                  <Feather name=\"x\" size={24} color={theme.text} />\n                </Pressable>\n              </View>\n\n              <ScrollView\n                style={styles.modalScrollView}\n                contentContainerStyle={[\n                  styles.modalScrollContent,\n                  { paddingBottom: insets.bottom + 16 },\n                ]}\n                showsVerticalScrollIndicator\n              >\n                <View\n                  style={[\n                    styles.errorContainer,\n                    { backgroundColor: theme.backgroundSecondary },\n                  ]}\n                >\n                  <Text\n                    style={[\n                      styles.errorText,\n                      {\n                        color: theme.text,\n                        fontFamily: monoFont,\n                      },\n                    ]}\n                    selectable\n                  >\n                    {formatErrorDetails()}\n                  </Text>\n                </View>\n              </ScrollView>\n            </View>\n          </View>\n        </Modal>\n      ) : null}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    width: \"100%\",\n    height: \"100%\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    padding: 24,\n  },\n  content: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    gap: 16,\n    width: \"100%\",\n    maxWidth: 600,\n  },\n  title: {\n    fontSize: 28,\n    fontWeight: \"700\",\n    textAlign: \"center\",\n    lineHeight: 40,\n  },\n  message: {\n    fontSize: 16,\n    textAlign: \"center\",\n    lineHeight: 24,\n  },\n  topButton: {\n    position: \"absolute\",\n    right: 16,\n    width: 44,\n    height: 44,\n    borderRadius: 8,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    zIndex: 10,\n  },\n  button: {\n    paddingVertical: 16,\n    borderRadius: 8,\n    paddingHorizontal: 24,\n    minWidth: 200,\n    shadowColor: \"#000\",\n    shadowOffset: {\n      width: 0,\n      height: 2,\n    },\n    shadowOpacity: 0.1,\n    shadowRadius: 4,\n    elevation: 3,\n  },\n  buttonText: {\n    fontWeight: \"600\",\n    textAlign: \"center\",\n    fontSize: 16,\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0, 0, 0, 0.5)\",\n    justifyContent: \"flex-end\",\n  },\n  modalContainer: {\n    width: \"100%\",\n    height: \"90%\",\n    borderTopLeftRadius: 16,\n    borderTopRightRadius: 16,\n  },\n  modalHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingHorizontal: 16,\n    paddingTop: 16,\n    paddingBottom: 12,\n    borderBottomWidth: 1,\n  },\n  modalTitle: {\n    fontSize: 20,\n    fontWeight: \"600\",\n  },\n  closeButton: {\n    width: 44,\n    height: 44,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  modalScrollView: {\n    flex: 1,\n  },\n  modalScrollContent: {\n    padding: 16,\n  },\n  errorContainer: {\n    width: \"100%\",\n    borderRadius: 8,\n    overflow: \"hidden\",\n    padding: 16,\n  },\n  errorText: {\n    fontSize: 12,\n    lineHeight: 18,\n    width: \"100%\",\n  },\n});\n","path":null,"size_bytes":7103,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport { createServer, type Server } from \"node:http\";\nimport { storage } from \"./storage\";\nimport {\n  insertUserSchema,\n  loginSchema,\n  updateProfileSchema,\n  updateRoleSchema,\n  insertMedicationSchema,\n  updateMedicationSchema,\n  insertConnectionSchema,\n} from \"@shared/schema\";\nimport bcrypt from \"bcryptjs\";\nimport session from \"express-session\";\nimport connectPgSimple from \"connect-pg-simple\";\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: string;\n  }\n}\n\nfunction requireAuth(req: Request, res: Response, next: () => void) {\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"Not authenticated\" });\n  }\n  next();\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  const PgSession = connectPgSimple(session);\n\n  app.use(\n    session({\n      store: new PgSession({\n        conString: process.env.DATABASE_URL,\n        createTableIfMissing: true,\n      }),\n      secret: process.env.SESSION_SECRET || \"medcontrol-secret-key\",\n      resave: false,\n      saveUninitialized: false,\n      cookie: {\n        secure: false,\n        httpOnly: true,\n        maxAge: 30 * 24 * 60 * 60 * 1000,\n        sameSite: \"lax\",\n      },\n    })\n  );\n\n  app.post(\"/api/auth/register\", async (req: Request, res: Response) => {\n    try {\n      const parsed = insertUserSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\", errors: parsed.error.flatten() });\n      }\n\n      const existing = await storage.getUserByEmail(parsed.data.email!);\n      if (existing) {\n        return res.status(409).json({ message: \"Email already registered\" });\n      }\n\n      const hashedPassword = await bcrypt.hash(parsed.data.password, 10);\n      const user = await storage.createUser({\n        ...parsed.data,\n        password: hashedPassword,\n      });\n\n      req.session.userId = user.id;\n      const { password: _, ...safeUser } = user;\n      res.status(201).json(safeUser);\n    } catch (error) {\n      console.error(\"Register error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.post(\"/api/auth/login\", async (req: Request, res: Response) => {\n    try {\n      const parsed = loginSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid credentials\" });\n      }\n\n      const user = await storage.getUserByEmail(parsed.data.email);\n      if (!user) {\n        return res.status(401).json({ message: \"Invalid email or password\" });\n      }\n\n      const valid = await bcrypt.compare(parsed.data.password, user.password);\n      if (!valid) {\n        return res.status(401).json({ message: \"Invalid email or password\" });\n      }\n\n      req.session.userId = user.id;\n      const { password: _, ...safeUser } = user;\n      res.json(safeUser);\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.post(\"/api/auth/logout\", (req: Request, res: Response) => {\n    req.session.destroy(() => {\n      res.json({ message: \"Logged out\" });\n    });\n  });\n\n  app.get(\"/api/auth/me\", async (req: Request, res: Response) => {\n    if (!req.session.userId) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    const user = await storage.getUserById(req.session.userId);\n    if (!user) {\n      return res.status(401).json({ message: \"User not found\" });\n    }\n    const { password: _, ...safeUser } = user;\n    res.json(safeUser);\n  });\n\n  app.patch(\"/api/auth/profile\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const parsed = updateProfileSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\" });\n      }\n\n      if (parsed.data.email) {\n        const existing = await storage.getUserByEmail(parsed.data.email);\n        if (existing && existing.id !== req.session.userId) {\n          return res.status(409).json({ message: \"Email already in use\" });\n        }\n      }\n\n      const updated = await storage.updateUser(req.session.userId!, parsed.data);\n      const { password: _, ...safeUser } = updated;\n      res.json(safeUser);\n    } catch (error) {\n      console.error(\"Update profile error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.patch(\"/api/auth/role\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const parsed = updateRoleSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid role\" });\n      }\n\n      const updated = await storage.updateUser(req.session.userId!, { role: parsed.data.role });\n      const { password: _, ...safeUser } = updated;\n      res.json(safeUser);\n    } catch (error) {\n      console.error(\"Update role error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.post(\"/api/auth/upgrade\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const updated = await storage.updateUser(req.session.userId!, { planType: \"PREMIUM\" });\n      const { password: _, ...safeUser } = updated;\n      res.json(safeUser);\n    } catch (error) {\n      console.error(\"Upgrade error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.get(\"/api/users/search/:identifier\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { identifier } = req.params;\n      let user = await storage.getUserById(identifier);\n      if (!user) {\n        user = await storage.getUserByEmail(identifier);\n      }\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      res.json({ id: user.id, name: user.name, email: user.email, role: user.role });\n    } catch (error) {\n      console.error(\"Search user error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.get(\"/api/medications\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const meds = await storage.getMedicationsByOwner(req.session.userId!);\n      res.json(meds);\n    } catch (error) {\n      console.error(\"Get medications error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.get(\"/api/medications/:id\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const med = await storage.getMedicationById(req.params.id);\n      if (!med) {\n        return res.status(404).json({ message: \"Medication not found\" });\n      }\n      res.json(med);\n    } catch (error) {\n      console.error(\"Get medication error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.post(\"/api/medications\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const parsed = insertMedicationSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\", errors: parsed.error.flatten() });\n      }\n\n      const med = await storage.createMedication({\n        ...parsed.data,\n        ownerId: req.session.userId!,\n      });\n      res.status(201).json(med);\n    } catch (error) {\n      console.error(\"Create medication error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.patch(\"/api/medications/:id\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const parsed = updateMedicationSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\" });\n      }\n\n      const updated = await storage.updateMedication(req.params.id, req.session.userId!, parsed.data);\n      if (!updated) {\n        return res.status(404).json({ message: \"Medication not found\" });\n      }\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Update medication error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.delete(\"/api/medications/:id\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      await storage.deleteMedication(req.params.id, req.session.userId!);\n      res.json({ message: \"Deleted\" });\n    } catch (error) {\n      console.error(\"Delete medication error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.patch(\"/api/medications/:id/stock\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { currentStock } = req.body;\n      if (typeof currentStock !== \"number\" || currentStock < 0) {\n        return res.status(400).json({ message: \"Invalid stock value\" });\n      }\n      await storage.updateMedicationStock(req.params.id, currentStock);\n      res.json({ message: \"Stock updated\" });\n    } catch (error) {\n      console.error(\"Update stock error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.get(\"/api/schedules\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const schedules = await storage.getSchedulesByOwner(req.session.userId!);\n      res.json(schedules);\n    } catch (error) {\n      console.error(\"Get schedules error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.get(\"/api/schedules/history\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const schedules = await storage.getConfirmedSchedulesByOwner(req.session.userId!);\n      const meds = await storage.getMedicationsByOwner(req.session.userId!);\n      const medMap = new Map(meds.map(m => [m.id, m]));\n\n      const enriched = schedules.map(s => ({\n        ...s,\n        medicationName: medMap.get(s.medId)?.name || \"Remedio removido\",\n        medicationDosage: medMap.get(s.medId)?.dosage || \"\",\n      }));\n\n      res.json(enriched);\n    } catch (error) {\n      console.error(\"Get history error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.post(\"/api/schedules\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { medId, timeMillis } = req.body;\n      if (!medId || !timeMillis) {\n        return res.status(400).json({ message: \"medId and timeMillis required\" });\n      }\n\n      const schedule = await storage.createSchedule({\n        medId,\n        timeMillis,\n        status: \"PENDING\",\n        confirmedAt: null,\n        ownerId: req.session.userId!,\n      });\n      res.status(201).json(schedule);\n    } catch (error) {\n      console.error(\"Create schedule error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.patch(\"/api/schedules/:id/confirm\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      await storage.updateScheduleStatus(req.params.id, \"TAKEN\", Date.now());\n      res.json({ message: \"Dose confirmed\" });\n    } catch (error) {\n      console.error(\"Confirm dose error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.post(\"/api/medications/:id/take-dose\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const medId = req.params.id;\n      const userId = req.session.userId!;\n      const now = Date.now();\n\n      const med = await storage.getMedicationById(medId);\n      if (!med) {\n        return res.status(404).json({ message: \"Medication not found\" });\n      }\n      if (med.ownerId !== userId) {\n        return res.status(403).json({ message: \"Not your medication\" });\n      }\n\n      const schedule = await storage.createSchedule({\n        medId,\n        timeMillis: now,\n        status: \"TAKEN\",\n        confirmedAt: now,\n        ownerId: userId,\n      });\n\n      if (med.currentStock > 0) {\n        await storage.updateMedicationStock(medId, med.currentStock - 1);\n      }\n\n      res.status(201).json({\n        schedule,\n        medName: med.name,\n        patientId: userId,\n        timestamp: now,\n        status: \"TAKEN\",\n      });\n    } catch (error) {\n      console.error(\"Take dose error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.get(\"/api/connections\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const user = await storage.getUserById(req.session.userId!);\n      if (!user) return res.status(401).json({ message: \"User not found\" });\n\n      if (user.role === \"MASTER\") {\n        const conns = await storage.getConnectionsByMaster(req.session.userId!);\n        const enriched = [];\n        for (const conn of conns) {\n          const dep = await storage.getUserById(conn.dependentId);\n          enriched.push({\n            ...conn,\n            linkedName: dep?.name || \"Unknown\",\n            linkedEmail: dep?.email || \"\",\n            linkedRole: dep?.role || \"\",\n          });\n        }\n        res.json(enriched);\n      } else {\n        const conns = await storage.getConnectionsByDependent(req.session.userId!);\n        const enriched = [];\n        for (const conn of conns) {\n          const master = await storage.getUserById(conn.masterId);\n          enriched.push({\n            ...conn,\n            linkedName: master?.name || \"Unknown\",\n            linkedEmail: master?.email || \"\",\n            linkedRole: master?.role || \"\",\n          });\n        }\n        res.json(enriched);\n      }\n    } catch (error) {\n      console.error(\"Get connections error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.post(\"/api/connections\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const user = await storage.getUserById(req.session.userId!);\n      if (!user) return res.status(401).json({ message: \"User not found\" });\n\n      if (user.role !== \"MASTER\") {\n        return res.status(403).json({ message: \"Only MASTER users can add connections\" });\n      }\n\n      const parsed = insertConnectionSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\" });\n      }\n\n      let target = await storage.getUserById(parsed.data.targetId);\n      if (!target) {\n        target = await storage.getUserByEmail(parsed.data.targetId);\n      }\n      if (!target) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      if (target.id === req.session.userId) {\n        return res.status(400).json({ message: \"Cannot connect to yourself\" });\n      }\n\n      if (user.planType === \"FREE\") {\n        const count = await storage.getConnectionCount(req.session.userId!);\n        if (count >= 1) {\n          return res.status(403).json({\n            message: \"Plano FREE limitado a 1 conexao. Faca upgrade para PREMIUM.\",\n            requiresUpgrade: true,\n          });\n        }\n      }\n\n      const conn = await storage.createConnection(req.session.userId!, target.id);\n      res.status(201).json({\n        ...conn,\n        linkedName: target.name,\n        linkedEmail: target.email,\n        linkedRole: target.role,\n      });\n    } catch (error) {\n      console.error(\"Create connection error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.delete(\"/api/connections/:id\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      await storage.deleteConnection(req.params.id);\n      res.json({ message: \"Connection removed\" });\n    } catch (error) {\n      console.error(\"Delete connection error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.patch(\"/api/connections/:id/accept\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      await storage.acceptConnection(req.params.id);\n      res.json({ message: \"Connection accepted\" });\n    } catch (error) {\n      console.error(\"Accept connection error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.get(\"/api/dependents/:id/medications\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const meds = await storage.getMedicationsByOwner(req.params.id);\n      res.json(meds);\n    } catch (error) {\n      console.error(\"Get dependent medications error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.get(\"/api/dependents\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const user = await storage.getUserById(req.session.userId!);\n      if (!user || user.role !== \"MASTER\") {\n        return res.status(403).json({ message: \"Only MASTER users can view dependents\" });\n      }\n\n      const dependents = await storage.getDependentsForMaster(req.session.userId!);\n      const enriched = [];\n\n      for (const dep of dependents) {\n        const schedules = await storage.getSchedulesByOwner(dep.id);\n        const today = new Date();\n        today.setHours(0, 0, 0, 0);\n        const todayStart = today.getTime();\n\n        const todaySchedules = schedules.filter(s => s.timeMillis >= todayStart);\n        const takenToday = todaySchedules.filter(s => s.status === \"TAKEN\").length;\n        const missedToday = todaySchedules.filter(s => s.status === \"MISSED\").length;\n\n        const meds = await storage.getMedicationsByOwner(dep.id);\n\n        enriched.push({\n          id: dep.id,\n          name: dep.name,\n          email: dep.email,\n          role: dep.role,\n          takenToday,\n          missedToday,\n          totalMeds: meds.length,\n        });\n      }\n\n      res.json(enriched);\n    } catch (error) {\n      console.error(\"Get dependents error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  app.get(\"/api/dependents/:id/history\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const user = await storage.getUserById(req.session.userId!);\n      if (!user || user.role !== \"MASTER\") {\n        return res.status(403).json({ message: \"Only MASTER users can view dependent history\" });\n      }\n\n      const depId = req.params.id;\n      const schedules = await storage.getSchedulesByOwnerWithStatus(depId, [\"TAKEN\", \"MISSED\"]);\n      const meds = await storage.getMedicationsByOwner(depId);\n      const medMap = new Map(meds.map(m => [m.id, m]));\n\n      const enriched = schedules.map(s => ({\n        ...s,\n        medicationName: medMap.get(s.medId)?.name || \"Remedio removido\",\n        medicationDosage: medMap.get(s.medId)?.dosage || \"\",\n      }));\n\n      res.json(enriched);\n    } catch (error) {\n      console.error(\"Get dependent history error:\", error);\n      res.status(500).json({ message: \"Server error\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","path":null,"size_bytes":18555,"size_tokens":null},"lib/query-client.ts":{"content":"import { fetch } from \"expo/fetch\";\nimport { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\n/**\n * Gets the base URL for the Express API server (e.g., \"http://localhost:3000\")\n * @returns {string} The API base URL\n */\nexport function getApiUrl(): string {\n  let host = process.env.EXPO_PUBLIC_DOMAIN;\n\n  if (!host) {\n    throw new Error(\"EXPO_PUBLIC_DOMAIN is not set\");\n  }\n\n  let url = new URL(`https://${host}`);\n\n  return url.href;\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  route: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const baseUrl = getApiUrl();\n  const url = new URL(route, baseUrl);\n\n  const res = await fetch(url.toString(), {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const baseUrl = getApiUrl();\n    const url = new URL(queryKey.join(\"/\") as string, baseUrl);\n\n    const res = await fetch(url.toString(), {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1934,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"app/dependent-detail.tsx":{"content":"import React from \"react\";\nimport {\n  View,\n  Text,\n  StyleSheet,\n  FlatList,\n  ActivityIndicator,\n  Platform,\n  RefreshControl,\n  Pressable,\n} from \"react-native\";\nimport { router, useLocalSearchParams } from \"expo-router\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport Colors from \"@/constants/colors\";\nimport { useTheme } from \"@/lib/theme-context\";\n\ninterface HistoryEntry {\n  id: string;\n  medId: string;\n  timeMillis: number;\n  status: string;\n  confirmedAt: number | null;\n  medicationName: string;\n  medicationDosage: string;\n}\n\nfunction HistoryItem({ item, colors }: { item: HistoryEntry; colors: typeof Colors.light }) {\n  const isTaken = item.status === \"TAKEN\";\n  const date = new Date(item.confirmedAt || item.timeMillis);\n  const day = date.toLocaleDateString(\"pt-BR\", { day: \"2-digit\", month: \"short\" });\n  const time = date.toLocaleTimeString(\"pt-BR\", { hour: \"2-digit\", minute: \"2-digit\" });\n\n  return (\n    <View style={[styles.historyCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n      <View style={[styles.historyIcon, { backgroundColor: isTaken ? colors.successLight : colors.dangerLight }]}>\n        <Ionicons\n          name={isTaken ? \"checkmark-circle\" : \"close-circle\"}\n          size={22}\n          color={isTaken ? colors.success : colors.danger}\n        />\n      </View>\n      <View style={styles.historyInfo}>\n        <Text style={[styles.historyMedName, { color: colors.text }]}>{item.medicationName}</Text>\n        <Text style={[styles.historyDosage, { color: colors.textSecondary }]}>{item.medicationDosage}</Text>\n        <View style={styles.historyMeta}>\n          <Ionicons name=\"calendar-outline\" size={12} color={colors.textSecondary} />\n          <Text style={[styles.historyMetaText, { color: colors.textSecondary }]}>{day}</Text>\n          <View style={[styles.metaDot, { backgroundColor: colors.textSecondary }]} />\n          <Ionicons name=\"time-outline\" size={12} color={colors.textSecondary} />\n          <Text style={[styles.historyMetaText, { color: colors.textSecondary }]}>{time}</Text>\n        </View>\n      </View>\n      <View style={[styles.statusBadge, { backgroundColor: isTaken ? colors.successLight : colors.dangerLight }]}>\n        <Text style={[styles.statusText, { color: isTaken ? colors.success : colors.danger }]}>\n          {isTaken ? \"Tomou\" : \"Perdeu\"}\n        </Text>\n      </View>\n    </View>\n  );\n}\n\nexport default function DependentDetailScreen() {\n  const insets = useSafeAreaInsets();\n  const { isDark } = useTheme();\n  const colors = isDark ? Colors.dark : Colors.light;\n  const { id, name } = useLocalSearchParams<{ id: string; name: string }>();\n\n  const historyQuery = useQuery<HistoryEntry[]>({\n    queryKey: [\"/api/dependents\", id, \"history\"],\n    enabled: !!id,\n  });\n\n  const medsQuery = useQuery({\n    queryKey: [\"/api/dependents\", id, \"medications\"],\n    enabled: !!id,\n  });\n\n  const history = historyQuery.data || [];\n  const meds = (medsQuery.data as any[]) || [];\n\n  return (\n    <View style={[styles.container, { backgroundColor: colors.background }]}>\n      <View style={[styles.header, { paddingTop: insets.top + (Platform.OS === \"web\" ? 67 : 0) + 8, backgroundColor: colors.surface, borderBottomColor: colors.border }]}>\n        <View style={styles.headerRow}>\n          <Pressable onPress={() => router.back()} hitSlop={12} style={[styles.backBtn, { backgroundColor: colors.inputBg }]}>\n            <Ionicons name=\"arrow-back\" size={24} color={colors.text} />\n          </Pressable>\n          <View style={styles.headerCenter}>\n            <Text style={[styles.headerTitle, { color: colors.text }]}>{name || \"Dependente\"}</Text>\n            <Text style={[styles.headerSubtitle, { color: colors.textSecondary }]}>Historico de doses</Text>\n          </View>\n          <View style={{ width: 36 }} />\n        </View>\n      </View>\n\n      <View style={styles.summaryRow}>\n        <View style={[styles.summaryCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n          <Ionicons name=\"medkit\" size={20} color={colors.tint} />\n          <Text style={[styles.summaryValue, { color: colors.text }]}>{meds.length}</Text>\n          <Text style={[styles.summaryLabel, { color: colors.textSecondary }]}>Remedios</Text>\n        </View>\n        <View style={[styles.summaryCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n          <Ionicons name=\"checkmark-circle\" size={20} color={colors.success} />\n          <Text style={[styles.summaryValue, { color: colors.success }]}>{history.filter(h => h.status === \"TAKEN\").length}</Text>\n          <Text style={[styles.summaryLabel, { color: colors.textSecondary }]}>Tomadas</Text>\n        </View>\n        <View style={[styles.summaryCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n          <Ionicons name=\"close-circle\" size={20} color={colors.danger} />\n          <Text style={[styles.summaryValue, { color: colors.danger }]}>{history.filter(h => h.status === \"MISSED\").length}</Text>\n          <Text style={[styles.summaryLabel, { color: colors.textSecondary }]}>Perdidas</Text>\n        </View>\n      </View>\n\n      {historyQuery.isLoading ? (\n        <View style={styles.loadingContainer}>\n          <ActivityIndicator size=\"large\" color={colors.tint} />\n          <Text style={[styles.loadingText, { color: colors.textSecondary }]}>Carregando historico...</Text>\n        </View>\n      ) : (\n        <FlatList\n          data={history}\n          keyExtractor={(item) => item.id}\n          renderItem={({ item }) => <HistoryItem item={item} colors={colors} />}\n          contentContainerStyle={[\n            styles.listContent,\n            { paddingBottom: insets.bottom + (Platform.OS === \"web\" ? 34 : 0) + 24 },\n            history.length === 0 && { flex: 1 },\n          ]}\n          showsVerticalScrollIndicator={false}\n          refreshControl={\n            <RefreshControl\n              refreshing={historyQuery.isRefetching}\n              onRefresh={() => {\n                historyQuery.refetch();\n                medsQuery.refetch();\n              }}\n              tintColor={colors.tint}\n            />\n          }\n          ListHeaderComponent={\n            history.length > 0 ? (\n              <Text style={[styles.sectionLabel, { color: colors.textSecondary }]}>\n                {history.length} {history.length === 1 ? \"registro\" : \"registros\"}\n              </Text>\n            ) : null\n          }\n          ListEmptyComponent={\n            <View style={styles.emptyContainer}>\n              <View style={[styles.emptyIcon, { backgroundColor: colors.inputBg }]}>\n                <Ionicons name=\"document-text-outline\" size={40} color={colors.textSecondary} />\n              </View>\n              <Text style={[styles.emptyTitle, { color: colors.text }]}>Nenhum registro</Text>\n              <Text style={[styles.emptySubtitle, { color: colors.textSecondary }]}>\n                Este dependente ainda nao possui historico de doses\n              </Text>\n            </View>\n          }\n        />\n      )}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  header: {\n    paddingHorizontal: 20,\n    paddingBottom: 14,\n    borderBottomWidth: 1,\n  },\n  headerRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n  },\n  backBtn: {\n    width: 36,\n    height: 36,\n    borderRadius: 12,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  headerCenter: {\n    alignItems: \"center\",\n  },\n  headerTitle: {\n    fontSize: 18,\n    fontFamily: \"Inter_700Bold\",\n  },\n  headerSubtitle: {\n    fontSize: 12,\n    fontFamily: \"Inter_400Regular\",\n    marginTop: 1,\n  },\n  summaryRow: {\n    flexDirection: \"row\",\n    paddingHorizontal: 20,\n    gap: 10,\n    paddingTop: 16,\n    paddingBottom: 8,\n  },\n  summaryCard: {\n    flex: 1,\n    borderRadius: 14,\n    padding: 12,\n    alignItems: \"center\",\n    gap: 4,\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 1,\n    shadowRadius: 8,\n    elevation: 2,\n  },\n  summaryValue: {\n    fontSize: 20,\n    fontFamily: \"Inter_700Bold\",\n  },\n  summaryLabel: {\n    fontSize: 11,\n    fontFamily: \"Inter_500Medium\",\n  },\n  listContent: {\n    padding: 20,\n  },\n  sectionLabel: {\n    fontSize: 13,\n    fontFamily: \"Inter_600SemiBold\",\n    textTransform: \"uppercase\" as const,\n    letterSpacing: 0.5,\n    marginBottom: 12,\n    paddingLeft: 4,\n  },\n  historyCard: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderRadius: 14,\n    padding: 14,\n    marginBottom: 10,\n    gap: 12,\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 1,\n    shadowRadius: 8,\n    elevation: 2,\n  },\n  historyIcon: {\n    width: 40,\n    height: 40,\n    borderRadius: 12,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  historyInfo: {\n    flex: 1,\n  },\n  historyMedName: {\n    fontSize: 14,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  historyDosage: {\n    fontSize: 12,\n    fontFamily: \"Inter_400Regular\",\n    marginTop: 1,\n  },\n  historyMeta: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    marginTop: 4,\n    gap: 4,\n  },\n  historyMetaText: {\n    fontSize: 11,\n    fontFamily: \"Inter_400Regular\",\n  },\n  metaDot: {\n    width: 3,\n    height: 3,\n    borderRadius: 2,\n    marginHorizontal: 2,\n  },\n  statusBadge: {\n    borderRadius: 8,\n    paddingHorizontal: 10,\n    paddingVertical: 4,\n  },\n  statusText: {\n    fontSize: 11,\n    fontFamily: \"Inter_700Bold\",\n  },\n  loadingContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    gap: 12,\n  },\n  loadingText: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n  },\n  emptyContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: 40,\n  },\n  emptyIcon: {\n    width: 80,\n    height: 80,\n    borderRadius: 24,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: 16,\n  },\n  emptyTitle: {\n    fontSize: 18,\n    fontFamily: \"Inter_700Bold\",\n    marginBottom: 6,\n  },\n  emptySubtitle: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n    textAlign: \"center\",\n    lineHeight: 20,\n  },\n});\n","path":null,"size_bytes":10250,"size_tokens":null},"constants/colors.ts":{"content":"const palette = {\n  teal600: \"#0D9488\",\n  teal500: \"#14B8A6\",\n  teal400: \"#2DD4BF\",\n  teal100: \"#CCFBF1\",\n  teal50: \"#F0FDFA\",\n  slate900: \"#0F172A\",\n  slate800: \"#1E293B\",\n  slate700: \"#334155\",\n  slate600: \"#475569\",\n  slate500: \"#64748B\",\n  slate400: \"#94A3B8\",\n  slate300: \"#CBD5E1\",\n  slate200: \"#E2E8F0\",\n  slate100: \"#F1F5F9\",\n  slate50: \"#F8FAFC\",\n  white: \"#FFFFFF\",\n  red500: \"#EF4444\",\n  red100: \"#FEE2E2\",\n  red900: \"#7F1D1D\",\n  amber500: \"#F59E0B\",\n  amber100: \"#FEF3C7\",\n  amber900: \"#78350F\",\n  green500: \"#22C55E\",\n  green100: \"#DCFCE7\",\n  green900: \"#14532D\",\n};\n\nconst light = {\n  text: palette.slate900,\n  textSecondary: palette.slate500,\n  background: palette.slate50,\n  surface: palette.white,\n  tint: palette.teal600,\n  tintLight: palette.teal100,\n  accent: palette.teal500,\n  border: palette.slate200,\n  tabIconDefault: palette.slate400,\n  tabIconSelected: palette.teal600,\n  danger: palette.red500,\n  dangerLight: palette.red100,\n  warning: palette.amber500,\n  warningLight: palette.amber100,\n  success: palette.green500,\n  successLight: palette.green100,\n  inputBg: palette.slate100,\n  cardShadow: \"rgba(15, 23, 42, 0.06)\",\n};\n\nconst dark: typeof light = {\n  text: palette.slate100,\n  textSecondary: palette.slate400,\n  background: \"#0B1120\",\n  surface: palette.slate800,\n  tint: palette.teal400,\n  tintLight: \"rgba(13, 148, 136, 0.15)\",\n  accent: palette.teal500,\n  border: palette.slate700,\n  tabIconDefault: palette.slate500,\n  tabIconSelected: palette.teal400,\n  danger: palette.red500,\n  dangerLight: \"rgba(239, 68, 68, 0.15)\",\n  warning: palette.amber500,\n  warningLight: \"rgba(245, 158, 11, 0.15)\",\n  success: palette.green500,\n  successLight: \"rgba(34, 197, 94, 0.15)\",\n  inputBg: palette.slate700,\n  cardShadow: \"rgba(0, 0, 0, 0.3)\",\n};\n\nexport default {\n  light,\n  dark,\n  palette,\n};\n","path":null,"size_bytes":1820,"size_tokens":null},"app/_layout.tsx":{"content":"import { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Stack } from \"expo-router\";\nimport * as SplashScreen from \"expo-splash-screen\";\nimport React, { useEffect } from \"react\";\nimport { GestureHandlerRootView } from \"react-native-gesture-handler\";\nimport { KeyboardProvider } from \"react-native-keyboard-controller\";\nimport { ErrorBoundary } from \"@/components/ErrorBoundary\";\nimport { queryClient } from \"@/lib/query-client\";\nimport { AuthProvider } from \"@/lib/auth-context\";\nimport { ThemeProvider, useTheme } from \"@/lib/theme-context\";\nimport { useFonts, Inter_400Regular, Inter_500Medium, Inter_600SemiBold, Inter_700Bold } from \"@expo-google-fonts/inter\";\nimport Colors from \"@/constants/colors\";\n\nSplashScreen.preventAutoHideAsync();\n\nfunction RootLayoutNav() {\n  const { isDark } = useTheme();\n  const colors = isDark ? Colors.dark : Colors.light;\n\n  return (\n    <Stack screenOptions={{ headerShown: false }}>\n      <Stack.Screen name=\"index\" />\n      <Stack.Screen name=\"login\" />\n      <Stack.Screen name=\"register\" />\n      <Stack.Screen name=\"(tabs)\" />\n      <Stack.Screen\n        name=\"add-medication\"\n        options={{\n          presentation: \"modal\",\n          headerShown: true,\n          headerTitle: \"Novo Medicamento\",\n          headerTintColor: colors.tint,\n          headerStyle: { backgroundColor: colors.surface },\n          headerTitleStyle: { color: colors.text },\n        }}\n      />\n      <Stack.Screen\n        name=\"edit-medication\"\n        options={{\n          presentation: \"modal\",\n          headerShown: true,\n          headerTitle: \"Editar Medicamento\",\n          headerTintColor: colors.tint,\n          headerStyle: { backgroundColor: colors.surface },\n          headerTitleStyle: { color: colors.text },\n        }}\n      />\n      <Stack.Screen\n        name=\"edit-profile\"\n        options={{\n          presentation: \"modal\",\n          headerShown: true,\n          headerTitle: \"Editar Perfil\",\n          headerTintColor: colors.tint,\n          headerStyle: { backgroundColor: colors.surface },\n          headerTitleStyle: { color: colors.text },\n        }}\n      />\n      <Stack.Screen name=\"connections\" />\n      <Stack.Screen name=\"dependent-detail\" />\n    </Stack>\n  );\n}\n\nexport default function RootLayout() {\n  const [fontsLoaded] = useFonts({\n    Inter_400Regular,\n    Inter_500Medium,\n    Inter_600SemiBold,\n    Inter_700Bold,\n  });\n\n  useEffect(() => {\n    if (fontsLoaded) {\n      SplashScreen.hideAsync();\n    }\n  }, [fontsLoaded]);\n\n  if (!fontsLoaded) return null;\n\n  return (\n    <ErrorBoundary>\n      <QueryClientProvider client={queryClient}>\n        <GestureHandlerRootView>\n          <KeyboardProvider>\n            <ThemeProvider>\n              <AuthProvider>\n                <RootLayoutNav />\n              </AuthProvider>\n            </ThemeProvider>\n          </KeyboardProvider>\n        </GestureHandlerRootView>\n      </QueryClientProvider>\n    </ErrorBoundary>\n  );\n}\n","path":null,"size_bytes":2945,"size_tokens":null},"app/(tabs)/_layout.tsx":{"content":"import { isLiquidGlassAvailable } from \"expo-glass-effect\";\nimport { Tabs } from \"expo-router\";\nimport { NativeTabs, Icon, Label } from \"expo-router/unstable-native-tabs\";\nimport { BlurView } from \"expo-blur\";\nimport { SymbolView } from \"expo-symbols\";\nimport { Platform, StyleSheet } from \"react-native\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport React from \"react\";\n\nimport Colors from \"@/constants/colors\";\nimport { useTheme } from \"@/lib/theme-context\";\n\nfunction NativeTabLayout() {\n  return (\n    <NativeTabs>\n      <NativeTabs.Trigger name=\"index\">\n        <Icon sf={{ default: \"house\", selected: \"house.fill\" }} />\n        <Label>Dashboard</Label>\n      </NativeTabs.Trigger>\n      <NativeTabs.Trigger name=\"medications\">\n        <Icon sf={{ default: \"pills\", selected: \"pills.fill\" }} />\n        <Label>Remedios</Label>\n      </NativeTabs.Trigger>\n      <NativeTabs.Trigger name=\"profile\">\n        <Icon sf={{ default: \"person\", selected: \"person.fill\" }} />\n        <Label>Perfil</Label>\n      </NativeTabs.Trigger>\n    </NativeTabs>\n  );\n}\n\nfunction ClassicTabLayout() {\n  const { isDark } = useTheme();\n  const colors = isDark ? Colors.dark : Colors.light;\n\n  return (\n    <Tabs\n      screenOptions={{\n        headerShown: false,\n        tabBarActiveTintColor: colors.tint,\n        tabBarInactiveTintColor: colors.tabIconDefault,\n        tabBarLabelStyle: {\n          fontFamily: \"Inter_500Medium\",\n          fontSize: 11,\n        },\n        tabBarStyle: {\n          position: \"absolute\",\n          backgroundColor: Platform.select({\n            ios: \"transparent\",\n            android: isDark ? Colors.dark.surface : Colors.light.surface,\n            default: isDark ? Colors.dark.surface : Colors.light.surface,\n          }),\n          borderTopWidth: 0,\n          elevation: 0,\n          height: Platform.OS === \"web\" ? 84 : undefined,\n        },\n        tabBarBackground: () =>\n          Platform.OS === \"ios\" ? (\n            <BlurView\n              intensity={100}\n              tint={isDark ? \"dark\" : \"light\"}\n              style={StyleSheet.absoluteFill}\n            />\n          ) : null,\n      }}\n    >\n      <Tabs.Screen\n        name=\"index\"\n        options={{\n          title: \"Dashboard\",\n          tabBarIcon: ({ color, size }) => (\n            <Ionicons name=\"home-outline\" size={size} color={color} />\n          ),\n        }}\n      />\n      <Tabs.Screen\n        name=\"medications\"\n        options={{\n          title: \"Remedios\",\n          tabBarIcon: ({ color, size }) => (\n            <Ionicons name=\"medkit-outline\" size={size} color={color} />\n          ),\n        }}\n      />\n      <Tabs.Screen\n        name=\"profile\"\n        options={{\n          title: \"Perfil\",\n          tabBarIcon: ({ color, size }) => (\n            <Ionicons name=\"person-outline\" size={size} color={color} />\n          ),\n        }}\n      />\n    </Tabs>\n  );\n}\n\nexport default function TabLayout() {\n  if (isLiquidGlassAvailable()) {\n    return <NativeTabLayout />;\n  }\n  return <ClassicTabLayout />;\n}\n","path":null,"size_bytes":3020,"size_tokens":null},"app/(tabs)/index.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  StyleSheet,\n  FlatList,\n  Pressable,\n  ActivityIndicator,\n  RefreshControl,\n  Platform,\n  Alert,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport { LinearGradient } from \"expo-linear-gradient\";\nimport { router } from \"expo-router\";\nimport * as Haptics from \"expo-haptics\";\nimport Colors from \"@/constants/colors\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { useTheme } from \"@/lib/theme-context\";\nimport { apiRequest, queryClient } from \"@/lib/query-client\";\n\ninterface Medication {\n  id: string;\n  name: string;\n  dosage: string;\n  currentStock: number;\n  alertThreshold: number;\n  intervalInHours: number;\n  ownerId: string;\n}\n\ninterface Schedule {\n  id: string;\n  medId: string;\n  timeMillis: number;\n  status: string;\n  confirmedAt: number | null;\n}\n\ninterface DependentSummary {\n  id: string;\n  name: string;\n  email: string;\n  role: string;\n  takenToday: number;\n  missedToday: number;\n  totalMeds: number;\n}\n\nfunction MedicationCard({ med, onConfirmDose, colors }: { med: Medication; onConfirmDose: (med: Medication) => void; colors: typeof Colors.light }) {\n  const isLowStock = med.currentStock <= med.alertThreshold;\n  const isOutOfStock = med.currentStock === 0;\n\n  return (\n    <Pressable\n      style={({ pressed }) => [styles.medCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }, pressed && styles.cardPressed]}\n      onPress={() => {}}\n    >\n      <View style={styles.medCardLeft}>\n        <View style={[styles.medIcon, { backgroundColor: colors.tintLight }, isOutOfStock && { backgroundColor: colors.dangerLight }, isLowStock && !isOutOfStock && { backgroundColor: colors.warningLight }]}>\n          <Ionicons\n            name=\"medical\"\n            size={22}\n            color={isOutOfStock ? colors.danger : isLowStock ? colors.warning : colors.tint}\n          />\n        </View>\n        <View style={styles.medInfo}>\n          <Text style={[styles.medName, { color: colors.text }]}>{med.name}</Text>\n          <Text style={[styles.medDosage, { color: colors.textSecondary }]}>{med.dosage}</Text>\n          <View style={styles.medMeta}>\n            <Ionicons name=\"time-outline\" size={12} color={colors.textSecondary} />\n            <Text style={[styles.medMetaText, { color: colors.textSecondary }]}>A cada {med.intervalInHours}h</Text>\n            <View style={[styles.metaDot, { backgroundColor: colors.textSecondary }]} />\n            <Ionicons\n              name=\"cube-outline\"\n              size={12}\n              color={isLowStock ? colors.warning : colors.textSecondary}\n            />\n            <Text style={[styles.medMetaText, { color: colors.textSecondary }, isLowStock && { color: colors.warning, fontFamily: \"Inter_600SemiBold\" }]}>\n              {med.currentStock} un.\n            </Text>\n          </View>\n        </View>\n      </View>\n\n      <Pressable\n        style={({ pressed }) => [styles.confirmBtn, { backgroundColor: colors.success }, pressed && styles.confirmBtnPressed]}\n        onPress={() => onConfirmDose(med)}\n      >\n        <Ionicons name=\"checkmark\" size={22} color=\"#fff\" />\n      </Pressable>\n    </Pressable>\n  );\n}\n\nfunction DependentCard({ dep, colors }: { dep: DependentSummary; colors: typeof Colors.light }) {\n  return (\n    <Pressable\n      style={({ pressed }) => [styles.depCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }, pressed && styles.cardPressed]}\n      onPress={() => router.push({ pathname: \"/dependent-detail\", params: { id: dep.id, name: dep.name } })}\n    >\n      <View style={styles.depCardLeft}>\n        <View style={[styles.depAvatar, { backgroundColor: colors.tintLight }]}>\n          <Text style={[styles.depAvatarText, { color: colors.tint }]}>\n            {dep.name?.charAt(0)?.toUpperCase() || \"?\"}\n          </Text>\n        </View>\n        <View style={styles.depInfo}>\n          <Text style={[styles.depName, { color: colors.text }]}>{dep.name}</Text>\n          <Text style={[styles.depEmail, { color: colors.textSecondary }]}>{dep.email}</Text>\n          <View style={styles.depStats}>\n            <View style={styles.depStatItem}>\n              <Ionicons name=\"medkit-outline\" size={12} color={colors.textSecondary} />\n              <Text style={[styles.depStatText, { color: colors.textSecondary }]}>{dep.totalMeds} remedios</Text>\n            </View>\n            <View style={[styles.metaDot, { backgroundColor: colors.textSecondary }]} />\n            <View style={styles.depStatItem}>\n              <Ionicons name=\"checkmark-circle-outline\" size={12} color={colors.success} />\n              <Text style={[styles.depStatText, { color: colors.success }]}>{dep.takenToday} hoje</Text>\n            </View>\n            {dep.missedToday > 0 && (\n              <>\n                <View style={[styles.metaDot, { backgroundColor: colors.textSecondary }]} />\n                <View style={styles.depStatItem}>\n                  <Ionicons name=\"close-circle-outline\" size={12} color={colors.danger} />\n                  <Text style={[styles.depStatText, { color: colors.danger }]}>{dep.missedToday} atrasos</Text>\n                </View>\n              </>\n            )}\n          </View>\n        </View>\n      </View>\n\n      <Ionicons name=\"chevron-forward\" size={20} color={colors.textSecondary} />\n    </Pressable>\n  );\n}\n\nexport default function DashboardScreen() {\n  const { user, refreshUser } = useAuth();\n  const insets = useSafeAreaInsets();\n  const { isDark } = useTheme();\n  const colors = isDark ? Colors.dark : Colors.light;\n  const isMaster = user?.role === \"MASTER\";\n  const [activeTab, setActiveTab] = useState<\"meds\" | \"deps\">(\"meds\");\n\n  const medsQuery = useQuery<Medication[]>({\n    queryKey: [\"/api/medications\"],\n  });\n\n  const dependentsQuery = useQuery<DependentSummary[]>({\n    queryKey: [\"/api/dependents\"],\n    enabled: isMaster,\n  });\n\n  const confirmMutation = useMutation({\n    mutationFn: async (med: Medication) => {\n      await apiRequest(\"POST\", `/api/medications/${med.id}/take-dose`);\n    },\n    onSuccess: () => {\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      queryClient.invalidateQueries({ queryKey: [\"/api/medications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/schedules/history\"] });\n      if (isMaster) {\n        queryClient.invalidateQueries({ queryKey: [\"/api/dependents\"] });\n      }\n    },\n  });\n\n  const medications = medsQuery.data || [];\n  const dependents = dependentsQuery.data || [];\n  const lowStockMeds = medications.filter((m) => m.currentStock <= m.alertThreshold && m.currentStock > 0);\n  const outOfStockMeds = medications.filter((m) => m.currentStock === 0);\n\n  const greeting = () => {\n    const hour = new Date().getHours();\n    if (hour < 12) return \"Bom dia\";\n    if (hour < 18) return \"Boa tarde\";\n    return \"Boa noite\";\n  };\n\n  const handleAddDependent = () => {\n    if (user?.planType === \"FREE\" && dependents.length >= 1) {\n      Alert.alert(\n        \"Limite do Plano Free\",\n        \"Voce atingiu o limite de 1 dependente do plano gratuito. Faca upgrade para Premium para monitorar dependentes ilimitados.\",\n        [\n          { text: \"Cancelar\", style: \"cancel\" },\n          {\n            text: \"Fazer Upgrade\",\n            onPress: async () => {\n              try {\n                await apiRequest(\"POST\", \"/api/auth/upgrade\");\n                await refreshUser();\n                Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n                Alert.alert(\"Sucesso\", \"Plano atualizado para Premium!\");\n              } catch (e: any) {\n                Alert.alert(\"Erro\", e.message || \"Nao foi possivel realizar o upgrade.\");\n              }\n            },\n          },\n        ]\n      );\n      return;\n    }\n    router.push(\"/connections\");\n  };\n\n  const renderMedsContent = () => {\n    if (medsQuery.isLoading) {\n      return (\n        <View style={styles.loadingContainer}>\n          <ActivityIndicator size=\"large\" color={colors.tint} />\n        </View>\n      );\n    }\n    if (medications.length === 0) {\n      return (\n        <View style={styles.emptyContainer}>\n          <Ionicons name=\"medkit-outline\" size={56} color={colors.border} />\n          <Text style={[styles.emptyTitle, { color: colors.text }]}>Nenhum remedio cadastrado</Text>\n          <Text style={[styles.emptyText, { color: colors.textSecondary }]}>Adicione seu primeiro medicamento</Text>\n          <Pressable\n            style={({ pressed }) => [styles.emptyBtn, { backgroundColor: colors.tint }, pressed && styles.cardPressed]}\n            onPress={() => router.push(\"/add-medication\")}\n          >\n            <Ionicons name=\"add\" size={20} color=\"#fff\" />\n            <Text style={styles.emptyBtnText}>Adicionar</Text>\n          </Pressable>\n        </View>\n      );\n    }\n    return (\n      <FlatList\n        data={medications}\n        keyExtractor={(item) => item.id}\n        renderItem={({ item }) => (\n          <MedicationCard med={item} onConfirmDose={(med) => confirmMutation.mutate(med)} colors={colors} />\n        )}\n        contentContainerStyle={styles.listContent}\n        showsVerticalScrollIndicator={false}\n        refreshControl={\n          <RefreshControl\n            refreshing={medsQuery.isFetching}\n            onRefresh={() => medsQuery.refetch()}\n            tintColor={colors.tint}\n          />\n        }\n      />\n    );\n  };\n\n  const renderDepsContent = () => {\n    if (dependentsQuery.isLoading) {\n      return (\n        <View style={styles.loadingContainer}>\n          <ActivityIndicator size=\"large\" color={colors.tint} />\n        </View>\n      );\n    }\n    if (dependents.length === 0) {\n      return (\n        <View style={styles.emptyContainer}>\n          <Ionicons name=\"people-outline\" size={56} color={colors.border} />\n          <Text style={[styles.emptyTitle, { color: colors.text }]}>Nenhum dependente</Text>\n          <Text style={[styles.emptyText, { color: colors.textSecondary }]}>Adicione um dependente para monitorar</Text>\n          <Pressable\n            style={({ pressed }) => [styles.emptyBtn, { backgroundColor: colors.tint }, pressed && styles.cardPressed]}\n            onPress={handleAddDependent}\n          >\n            <Ionicons name=\"person-add\" size={20} color=\"#fff\" />\n            <Text style={styles.emptyBtnText}>Adicionar</Text>\n          </Pressable>\n        </View>\n      );\n    }\n    return (\n      <FlatList\n        data={dependents}\n        keyExtractor={(item) => item.id}\n        renderItem={({ item }) => <DependentCard dep={item} colors={colors} />}\n        contentContainerStyle={styles.listContent}\n        showsVerticalScrollIndicator={false}\n        refreshControl={\n          <RefreshControl\n            refreshing={dependentsQuery.isFetching}\n            onRefresh={() => dependentsQuery.refetch()}\n            tintColor={colors.tint}\n          />\n        }\n      />\n    );\n  };\n\n  return (\n    <View style={[styles.container, { backgroundColor: colors.background }]}>\n      <LinearGradient\n        colors={[Colors.palette.teal600, Colors.palette.teal500]}\n        style={[styles.header, { paddingTop: insets.top + (Platform.OS === \"web\" ? 67 : 0) + 16 }]}\n      >\n        <View style={styles.headerRow}>\n          <View>\n            <Text style={styles.greeting}>{greeting()}</Text>\n            <Text style={styles.userName}>{user?.name || \"Usuario\"}</Text>\n          </View>\n          <View style={styles.roleChip}>\n            <Text style={styles.roleChipText}>\n              {user?.role === \"MASTER\" ? \"Responsavel\" : user?.role === \"DEPENDENT\" ? \"Dependente\" : \"Controle\"}\n            </Text>\n          </View>\n        </View>\n\n        {(lowStockMeds.length > 0 || outOfStockMeds.length > 0) && (\n          <View style={styles.alertBanner}>\n            <Ionicons name=\"warning\" size={16} color={colors.warning} />\n            <Text style={styles.alertText}>\n              {outOfStockMeds.length > 0\n                ? `${outOfStockMeds.length} remedio(s) sem estoque`\n                : `${lowStockMeds.length} remedio(s) com estoque baixo`}\n            </Text>\n          </View>\n        )}\n      </LinearGradient>\n\n      <View style={styles.statsRow}>\n        <View style={[styles.statCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n          <Text style={[styles.statValue, { color: colors.text }]}>{medications.length}</Text>\n          <Text style={[styles.statLabel, { color: colors.textSecondary }]}>Remedios</Text>\n        </View>\n        <View style={[styles.statCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n          <Text style={[styles.statValue, { color: colors.success }]}>{medications.filter(m => m.currentStock > m.alertThreshold).length}</Text>\n          <Text style={[styles.statLabel, { color: colors.textSecondary }]}>Estoque OK</Text>\n        </View>\n        <View style={[styles.statCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n          <Text style={[styles.statValue, { color: colors.warning }]}>{lowStockMeds.length + outOfStockMeds.length}</Text>\n          <Text style={[styles.statLabel, { color: colors.textSecondary }]}>Alertas</Text>\n        </View>\n      </View>\n\n      {isMaster && (\n        <View style={[styles.segmentControl, { backgroundColor: colors.inputBg }]}>\n          <Pressable\n            style={[styles.segmentBtn, activeTab === \"meds\" && [styles.segmentBtnActive, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]]}\n            onPress={() => { Haptics.selectionAsync(); setActiveTab(\"meds\"); }}\n          >\n            <Ionicons name=\"medkit-outline\" size={16} color={activeTab === \"meds\" ? colors.tint : colors.textSecondary} />\n            <Text style={[styles.segmentText, { color: activeTab === \"meds\" ? colors.tint : colors.textSecondary }, activeTab === \"meds\" && styles.segmentTextActive]}>\n              Meus Remedios\n            </Text>\n          </Pressable>\n          <Pressable\n            style={[styles.segmentBtn, activeTab === \"deps\" && [styles.segmentBtnActive, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]]}\n            onPress={() => { Haptics.selectionAsync(); setActiveTab(\"deps\"); }}\n          >\n            <Ionicons name=\"people-outline\" size={16} color={activeTab === \"deps\" ? colors.tint : colors.textSecondary} />\n            <Text style={[styles.segmentText, { color: activeTab === \"deps\" ? colors.tint : colors.textSecondary }, activeTab === \"deps\" && styles.segmentTextActive]}>\n              Meus Dependentes\n            </Text>\n          </Pressable>\n        </View>\n      )}\n\n      {(!isMaster || activeTab === \"meds\") && (\n        <View style={styles.sectionHeader}>\n          <Text style={[styles.sectionTitle, { color: colors.text }]}>\n            {isMaster ? \"\" : \"Seus Remedios\"}\n          </Text>\n          <Pressable\n            style={({ pressed }) => [styles.addBtn, { backgroundColor: colors.tintLight }, pressed && { opacity: 0.7 }]}\n            onPress={() => router.push(\"/add-medication\")}\n          >\n            <Ionicons name=\"add\" size={22} color={colors.tint} />\n          </Pressable>\n        </View>\n      )}\n\n      {activeTab === \"deps\" && isMaster && (\n        <View style={styles.sectionHeader}>\n          <Text style={[styles.sectionTitle, { color: colors.text }]}>{\"\"}</Text>\n          <Pressable\n            style={({ pressed }) => [styles.addBtn, { backgroundColor: colors.tintLight }, pressed && { opacity: 0.7 }]}\n            onPress={handleAddDependent}\n          >\n            <Ionicons name=\"person-add\" size={18} color={colors.tint} />\n          </Pressable>\n        </View>\n      )}\n\n      {(!isMaster || activeTab === \"meds\") ? renderMedsContent() : renderDepsContent()}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  header: {\n    paddingBottom: 20,\n    paddingHorizontal: 20,\n    borderBottomLeftRadius: 24,\n    borderBottomRightRadius: 24,\n  },\n  headerRow: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"flex-start\",\n  },\n  greeting: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n    color: \"rgba(255,255,255,0.8)\",\n  },\n  userName: {\n    fontSize: 22,\n    fontFamily: \"Inter_700Bold\",\n    color: \"#fff\",\n    marginTop: 2,\n  },\n  roleChip: {\n    backgroundColor: \"rgba(255,255,255,0.2)\",\n    borderRadius: 20,\n    paddingHorizontal: 12,\n    paddingVertical: 6,\n  },\n  roleChipText: {\n    fontSize: 12,\n    fontFamily: \"Inter_600SemiBold\",\n    color: \"#fff\",\n  },\n  alertBanner: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: \"rgba(255,255,255,0.15)\",\n    borderRadius: 12,\n    padding: 10,\n    marginTop: 14,\n    gap: 8,\n  },\n  alertText: {\n    fontSize: 13,\n    fontFamily: \"Inter_500Medium\",\n    color: \"#fff\",\n  },\n  statsRow: {\n    flexDirection: \"row\",\n    paddingHorizontal: 20,\n    gap: 10,\n    marginTop: -1,\n    paddingTop: 16,\n  },\n  statCard: {\n    flex: 1,\n    borderRadius: 14,\n    padding: 14,\n    alignItems: \"center\",\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 1,\n    shadowRadius: 8,\n    elevation: 2,\n  },\n  statValue: {\n    fontSize: 22,\n    fontFamily: \"Inter_700Bold\",\n  },\n  statLabel: {\n    fontSize: 11,\n    fontFamily: \"Inter_500Medium\",\n    marginTop: 2,\n  },\n  segmentControl: {\n    flexDirection: \"row\",\n    marginHorizontal: 20,\n    marginTop: 16,\n    borderRadius: 12,\n    padding: 3,\n    gap: 3,\n  },\n  segmentBtn: {\n    flex: 1,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingVertical: 10,\n    borderRadius: 10,\n    gap: 6,\n  },\n  segmentBtnActive: {\n    shadowOffset: { width: 0, height: 1 },\n    shadowOpacity: 0.15,\n    shadowRadius: 4,\n    elevation: 2,\n  },\n  segmentText: {\n    fontSize: 13,\n    fontFamily: \"Inter_500Medium\",\n  },\n  segmentTextActive: {\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  sectionHeader: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingHorizontal: 20,\n    paddingTop: 16,\n    paddingBottom: 8,\n  },\n  sectionTitle: {\n    fontSize: 17,\n    fontFamily: \"Inter_700Bold\",\n  },\n  addBtn: {\n    width: 36,\n    height: 36,\n    borderRadius: 12,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  listContent: {\n    paddingHorizontal: 20,\n    paddingBottom: 100,\n    gap: 10,\n  },\n  medCard: {\n    borderRadius: 16,\n    padding: 14,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 1,\n    shadowRadius: 8,\n    elevation: 2,\n  },\n  cardPressed: {\n    opacity: 0.9,\n    transform: [{ scale: 0.98 }],\n  },\n  medCardLeft: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    flex: 1,\n    gap: 12,\n  },\n  medIcon: {\n    width: 44,\n    height: 44,\n    borderRadius: 13,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  medInfo: {\n    flex: 1,\n  },\n  medName: {\n    fontSize: 15,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  medDosage: {\n    fontSize: 13,\n    fontFamily: \"Inter_400Regular\",\n    marginTop: 1,\n  },\n  medMeta: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    marginTop: 4,\n    gap: 4,\n  },\n  medMetaText: {\n    fontSize: 11,\n    fontFamily: \"Inter_400Regular\",\n  },\n  metaDot: {\n    width: 3,\n    height: 3,\n    borderRadius: 2,\n    marginHorizontal: 2,\n  },\n  confirmBtn: {\n    width: 44,\n    height: 44,\n    borderRadius: 13,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  confirmBtnPressed: {\n    opacity: 0.8,\n    transform: [{ scale: 0.95 }],\n  },\n  depCard: {\n    borderRadius: 16,\n    padding: 14,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 1,\n    shadowRadius: 8,\n    elevation: 2,\n  },\n  depCardLeft: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    flex: 1,\n    gap: 12,\n  },\n  depAvatar: {\n    width: 44,\n    height: 44,\n    borderRadius: 14,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  depAvatarText: {\n    fontSize: 18,\n    fontFamily: \"Inter_700Bold\",\n  },\n  depInfo: {\n    flex: 1,\n  },\n  depName: {\n    fontSize: 15,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  depEmail: {\n    fontSize: 12,\n    fontFamily: \"Inter_400Regular\",\n    marginTop: 1,\n  },\n  depStats: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    marginTop: 4,\n    gap: 4,\n    flexWrap: \"wrap\",\n  },\n  depStatItem: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: 3,\n  },\n  depStatText: {\n    fontSize: 11,\n    fontFamily: \"Inter_400Regular\",\n  },\n  loadingContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  emptyContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: 40,\n    gap: 8,\n  },\n  emptyTitle: {\n    fontSize: 17,\n    fontFamily: \"Inter_600SemiBold\",\n    marginTop: 8,\n  },\n  emptyText: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n    textAlign: \"center\" as const,\n  },\n  emptyBtn: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderRadius: 14,\n    paddingHorizontal: 20,\n    paddingVertical: 12,\n    gap: 6,\n    marginTop: 12,\n  },\n  emptyBtnText: {\n    fontSize: 15,\n    fontFamily: \"Inter_600SemiBold\",\n    color: \"#fff\",\n  },\n});\n","path":null,"size_bytes":21477,"size_tokens":null},"app/+native-intent.tsx":{"content":"export function redirectSystemPath({\n  path,\n  initial,\n}: { path: string; initial: boolean }) {\n  return '/';\n}\n","path":null,"size_bytes":113,"size_tokens":null},"components/ErrorBoundary.tsx":{"content":"import React, { Component, ComponentType, PropsWithChildren } from \"react\";\nimport { ErrorFallback, ErrorFallbackProps } from \"@/components/ErrorFallback\";\n\nexport type ErrorBoundaryProps = PropsWithChildren<{\n  FallbackComponent?: ComponentType<ErrorFallbackProps>;\n  onError?: (error: Error, stackTrace: string) => void;\n}>;\n\ntype ErrorBoundaryState = { error: Error | null };\n\n/**\n * This is a special case for for using the class components. Error boundaries must be class components because React only provides error boundary functionality through lifecycle methods (componentDidCatch and getDerivedStateFromError) which are not available in functional components.\n * https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary\n */\n\nexport class ErrorBoundary extends Component<\n  ErrorBoundaryProps,\n  ErrorBoundaryState\n> {\n  state: ErrorBoundaryState = { error: null };\n\n  static defaultProps: {\n    FallbackComponent: ComponentType<ErrorFallbackProps>;\n  } = {\n    FallbackComponent: ErrorFallback,\n  };\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { error };\n  }\n\n  componentDidCatch(error: Error, info: { componentStack: string }): void {\n    if (typeof this.props.onError === \"function\") {\n      this.props.onError(error, info.componentStack);\n    }\n  }\n\n  resetError = (): void => {\n    this.setState({ error: null });\n  };\n\n  render() {\n    const { FallbackComponent } = this.props;\n\n    return this.state.error && FallbackComponent ? (\n      <FallbackComponent\n        error={this.state.error}\n        resetError={this.resetError}\n      />\n    ) : (\n      this.props.children\n    );\n  }\n}\n","path":null,"size_bytes":1674,"size_tokens":null},"app/login.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  TextInput,\n  Pressable,\n  StyleSheet,\n  ActivityIndicator,\n  Alert,\n  Platform,\n  KeyboardAvoidingView,\n  ScrollView,\n} from \"react-native\";\nimport { router } from \"expo-router\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport { LinearGradient } from \"expo-linear-gradient\";\nimport Colors from \"@/constants/colors\";\nimport { useAuth } from \"@/lib/auth-context\";\n\nexport default function LoginScreen() {\n  const { login } = useAuth();\n  const insets = useSafeAreaInsets();\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n\n  const handleLogin = async () => {\n    if (!email.trim() || !password.trim()) {\n      Alert.alert(\"Erro\", \"Preencha todos os campos\");\n      return;\n    }\n    setLoading(true);\n    try {\n      await login(email.trim(), password);\n      router.replace(\"/(tabs)\");\n    } catch (err: any) {\n      Alert.alert(\"Erro\", err.message || \"Falha ao entrar\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <View style={styles.container}>\n      <LinearGradient\n        colors={[Colors.palette.teal600, Colors.palette.teal400]}\n        style={[styles.header, { paddingTop: insets.top + (Platform.OS === \"web\" ? 67 : 0) + 40 }]}\n      >\n        <View style={styles.iconContainer}>\n          <Ionicons name=\"medical\" size={40} color=\"#fff\" />\n        </View>\n        <Text style={styles.brandTitle}>MedControl</Text>\n        <Text style={styles.brandSubtitle}>Controle de medicamentos</Text>\n      </LinearGradient>\n\n      <KeyboardAvoidingView\n        behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\n        style={styles.formContainer}\n      >\n        <ScrollView\n          contentContainerStyle={styles.formContent}\n          keyboardShouldPersistTaps=\"handled\"\n          showsVerticalScrollIndicator={false}\n        >\n          <Text style={styles.formTitle}>Entrar</Text>\n\n          <View style={styles.inputWrapper}>\n            <Ionicons name=\"mail-outline\" size={20} color={Colors.light.textSecondary} style={styles.inputIcon} />\n            <TextInput\n              style={styles.input}\n              placeholder=\"Email\"\n              placeholderTextColor={Colors.light.textSecondary}\n              value={email}\n              onChangeText={setEmail}\n              keyboardType=\"email-address\"\n              autoCapitalize=\"none\"\n              autoCorrect={false}\n            />\n          </View>\n\n          <View style={styles.inputWrapper}>\n            <Ionicons name=\"lock-closed-outline\" size={20} color={Colors.light.textSecondary} style={styles.inputIcon} />\n            <TextInput\n              style={styles.input}\n              placeholder=\"Senha\"\n              placeholderTextColor={Colors.light.textSecondary}\n              value={password}\n              onChangeText={setPassword}\n              secureTextEntry={!showPassword}\n            />\n            <Pressable onPress={() => setShowPassword(!showPassword)} style={styles.eyeBtn}>\n              <Ionicons name={showPassword ? \"eye-off-outline\" : \"eye-outline\"} size={20} color={Colors.light.textSecondary} />\n            </Pressable>\n          </View>\n\n          <Pressable\n            style={({ pressed }) => [styles.loginBtn, pressed && styles.btnPressed, loading && styles.btnDisabled]}\n            onPress={handleLogin}\n            disabled={loading}\n          >\n            {loading ? (\n              <ActivityIndicator color=\"#fff\" />\n            ) : (\n              <Text style={styles.loginBtnText}>Entrar</Text>\n            )}\n          </Pressable>\n\n          <View style={styles.divider}>\n            <View style={styles.dividerLine} />\n            <Text style={styles.dividerText}>ou</Text>\n            <View style={styles.dividerLine} />\n          </View>\n\n          <Pressable\n            style={({ pressed }) => [styles.registerBtn, pressed && styles.registerBtnPressed]}\n            onPress={() => router.push(\"/register\")}\n          >\n            <Text style={styles.registerBtnText}>Criar conta</Text>\n          </Pressable>\n        </ScrollView>\n      </KeyboardAvoidingView>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: Colors.light.background,\n  },\n  header: {\n    paddingBottom: 40,\n    paddingHorizontal: 24,\n    alignItems: \"center\",\n    borderBottomLeftRadius: 32,\n    borderBottomRightRadius: 32,\n  },\n  iconContainer: {\n    width: 72,\n    height: 72,\n    borderRadius: 20,\n    backgroundColor: \"rgba(255,255,255,0.2)\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: 16,\n  },\n  brandTitle: {\n    fontSize: 28,\n    fontFamily: \"Inter_700Bold\",\n    color: \"#fff\",\n    marginBottom: 4,\n  },\n  brandSubtitle: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n    color: \"rgba(255,255,255,0.85)\",\n  },\n  formContainer: {\n    flex: 1,\n  },\n  formContent: {\n    padding: 24,\n    paddingTop: 32,\n  },\n  formTitle: {\n    fontSize: 24,\n    fontFamily: \"Inter_700Bold\",\n    color: Colors.light.text,\n    marginBottom: 24,\n  },\n  inputWrapper: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: Colors.light.inputBg,\n    borderRadius: 14,\n    marginBottom: 14,\n    paddingHorizontal: 14,\n    height: 52,\n    borderWidth: 1,\n    borderColor: Colors.light.border,\n  },\n  inputIcon: {\n    marginRight: 10,\n  },\n  input: {\n    flex: 1,\n    fontSize: 15,\n    fontFamily: \"Inter_400Regular\",\n    color: Colors.light.text,\n  },\n  eyeBtn: {\n    padding: 6,\n  },\n  loginBtn: {\n    backgroundColor: Colors.light.tint,\n    borderRadius: 14,\n    height: 52,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginTop: 10,\n  },\n  btnPressed: {\n    opacity: 0.85,\n    transform: [{ scale: 0.98 }],\n  },\n  btnDisabled: {\n    opacity: 0.6,\n  },\n  loginBtnText: {\n    color: \"#fff\",\n    fontSize: 16,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  divider: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    marginVertical: 24,\n  },\n  dividerLine: {\n    flex: 1,\n    height: 1,\n    backgroundColor: Colors.light.border,\n  },\n  dividerText: {\n    marginHorizontal: 16,\n    fontSize: 13,\n    fontFamily: \"Inter_400Regular\",\n    color: Colors.light.textSecondary,\n  },\n  registerBtn: {\n    borderRadius: 14,\n    height: 52,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderWidth: 2,\n    borderColor: Colors.light.tint,\n  },\n  registerBtnPressed: {\n    backgroundColor: Colors.light.tintLight,\n  },\n  registerBtnText: {\n    color: Colors.light.tint,\n    fontSize: 16,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n});\n","path":null,"size_bytes":6759,"size_tokens":null},"lib/theme-context.tsx":{"content":"import React, { createContext, useContext, useState, useEffect, useMemo, ReactNode } from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\ntype ThemeMode = \"light\" | \"dark\";\n\ninterface ThemeContextValue {\n  theme: ThemeMode;\n  setTheme: (t: ThemeMode) => void;\n  isDark: boolean;\n}\n\nconst ThemeContext = createContext<ThemeContextValue | null>(null);\n\nconst THEME_KEY = \"@medcontrol_theme\";\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const [theme, setThemeState] = useState<ThemeMode>(\"light\");\n\n  useEffect(() => {\n    AsyncStorage.getItem(THEME_KEY).then((val) => {\n      if (val === \"dark\" || val === \"light\") {\n        setThemeState(val);\n      }\n    });\n  }, []);\n\n  const setTheme = (t: ThemeMode) => {\n    setThemeState(t);\n    AsyncStorage.setItem(THEME_KEY, t);\n  };\n\n  const value = useMemo(\n    () => ({ theme, setTheme, isDark: theme === \"dark\" }),\n    [theme]\n  );\n\n  return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>;\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":1210,"size_tokens":null},"app/add-medication.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  TextInput,\n  Pressable,\n  StyleSheet,\n  Alert,\n  ActivityIndicator,\n  ScrollView,\n  Platform,\n  KeyboardAvoidingView,\n} from \"react-native\";\nimport { router } from \"expo-router\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport * as Haptics from \"expo-haptics\";\nimport Colors from \"@/constants/colors\";\nimport { apiRequest, queryClient } from \"@/lib/query-client\";\nimport { useTheme } from \"@/lib/theme-context\";\n\nconst intervals = [\n  { label: \"4h\", value: 4 },\n  { label: \"6h\", value: 6 },\n  { label: \"8h\", value: 8 },\n  { label: \"12h\", value: 12 },\n  { label: \"24h\", value: 24 },\n];\n\nexport default function AddMedicationScreen() {\n  const insets = useSafeAreaInsets();\n  const { isDark } = useTheme();\n  const colors = isDark ? Colors.dark : Colors.light;\n  const [name, setName] = useState(\"\");\n  const [dosage, setDosage] = useState(\"\");\n  const [currentStock, setCurrentStock] = useState(\"\");\n  const [alertThreshold, setAlertThreshold] = useState(\"5\");\n  const [intervalInHours, setIntervalInHours] = useState(8);\n\n  const createMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/medications\", {\n        name: name.trim(),\n        dosage: dosage.trim(),\n        currentStock: parseInt(currentStock, 10) || 0,\n        alertThreshold: parseInt(alertThreshold, 10) || 5,\n        intervalInHours,\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      queryClient.invalidateQueries({ queryKey: [\"/api/medications\"] });\n      router.back();\n    },\n    onError: (err: any) => {\n      Alert.alert(\"Erro\", err.message || \"Falha ao salvar medicamento\");\n    },\n  });\n\n  const handleSave = () => {\n    if (!name.trim()) {\n      Alert.alert(\"Erro\", \"Informe o nome do medicamento\");\n      return;\n    }\n    if (!dosage.trim()) {\n      Alert.alert(\"Erro\", \"Informe a dosagem\");\n      return;\n    }\n    createMutation.mutate();\n  };\n\n  return (\n    <KeyboardAvoidingView\n      style={[styles.container, { backgroundColor: colors.background }]}\n      behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\n      keyboardVerticalOffset={90}\n    >\n      <ScrollView\n        contentContainerStyle={[styles.content, { paddingBottom: insets.bottom + (Platform.OS === \"web\" ? 34 : 0) + 24 }]}\n        keyboardShouldPersistTaps=\"handled\"\n        showsVerticalScrollIndicator={false}\n      >\n        <View style={styles.iconHeader}>\n          <View style={[styles.bigIcon, { backgroundColor: colors.tintLight }]}>\n            <Ionicons name=\"medical\" size={36} color={colors.tint} />\n          </View>\n          <Text style={[styles.subtitle, { color: colors.textSecondary }]}>Adicione os detalhes do medicamento</Text>\n        </View>\n\n        <Text style={[styles.label, { color: colors.text }]}>Nome do medicamento</Text>\n        <View style={[styles.inputWrapper, { backgroundColor: colors.surface, borderColor: colors.border }]}>\n          <Ionicons name=\"medkit-outline\" size={18} color={colors.textSecondary} style={styles.inputIcon} />\n          <TextInput\n            style={[styles.input, { color: colors.text }]}\n            placeholder=\"Ex: Dipirona\"\n            placeholderTextColor={colors.textSecondary}\n            value={name}\n            onChangeText={setName}\n          />\n        </View>\n\n        <Text style={[styles.label, { color: colors.text }]}>Dosagem</Text>\n        <View style={[styles.inputWrapper, { backgroundColor: colors.surface, borderColor: colors.border }]}>\n          <Ionicons name=\"flask-outline\" size={18} color={colors.textSecondary} style={styles.inputIcon} />\n          <TextInput\n            style={[styles.input, { color: colors.text }]}\n            placeholder=\"Ex: 500mg, 1 comprimido\"\n            placeholderTextColor={colors.textSecondary}\n            value={dosage}\n            onChangeText={setDosage}\n          />\n        </View>\n\n        <Text style={[styles.label, { color: colors.text }]}>Intervalo entre doses</Text>\n        <View style={styles.intervalRow}>\n          {intervals.map((i) => (\n            <Pressable\n              key={i.value}\n              style={[\n                styles.intervalChip,\n                { backgroundColor: colors.surface, borderColor: colors.border },\n                intervalInHours === i.value && { borderColor: colors.tint, backgroundColor: colors.tintLight },\n              ]}\n              onPress={() => {\n                Haptics.selectionAsync();\n                setIntervalInHours(i.value);\n              }}\n            >\n              <Text style={[styles.intervalText, { color: colors.textSecondary }, intervalInHours === i.value && { color: colors.tint }]}>\n                {i.label}\n              </Text>\n            </Pressable>\n          ))}\n        </View>\n\n        <View style={styles.stockRow}>\n          <View style={styles.stockField}>\n            <Text style={[styles.label, { color: colors.text }]}>Estoque atual</Text>\n            <View style={[styles.inputWrapper, { backgroundColor: colors.surface, borderColor: colors.border }]}>\n              <Ionicons name=\"cube-outline\" size={18} color={colors.textSecondary} style={styles.inputIcon} />\n              <TextInput\n                style={[styles.input, { color: colors.text }]}\n                placeholder=\"0\"\n                placeholderTextColor={colors.textSecondary}\n                value={currentStock}\n                onChangeText={setCurrentStock}\n                keyboardType=\"number-pad\"\n              />\n            </View>\n          </View>\n\n          <View style={styles.stockField}>\n            <Text style={[styles.label, { color: colors.text }]}>Alerta em</Text>\n            <View style={[styles.inputWrapper, { backgroundColor: colors.surface, borderColor: colors.border }]}>\n              <Ionicons name=\"notifications-outline\" size={18} color={colors.textSecondary} style={styles.inputIcon} />\n              <TextInput\n                style={[styles.input, { color: colors.text }]}\n                placeholder=\"5\"\n                placeholderTextColor={colors.textSecondary}\n                value={alertThreshold}\n                onChangeText={setAlertThreshold}\n                keyboardType=\"number-pad\"\n              />\n            </View>\n          </View>\n        </View>\n\n        <View style={[styles.infoBox, { backgroundColor: colors.tintLight }]}>\n          <Ionicons name=\"information-circle-outline\" size={18} color={colors.tint} />\n          <Text style={[styles.infoText, { color: colors.tint }]}>\n            Voce sera alertado quando o estoque atingir {alertThreshold || \"5\"} unidades\n          </Text>\n        </View>\n\n        <Pressable\n          style={({ pressed }) => [\n            styles.saveBtn,\n            { backgroundColor: colors.tint },\n            pressed && styles.saveBtnPressed,\n            createMutation.isPending && styles.saveBtnDisabled,\n          ]}\n          onPress={handleSave}\n          disabled={createMutation.isPending}\n        >\n          {createMutation.isPending ? (\n            <ActivityIndicator color=\"#fff\" />\n          ) : (\n            <>\n              <Ionicons name=\"checkmark\" size={22} color=\"#fff\" />\n              <Text style={styles.saveBtnText}>Salvar Medicamento</Text>\n            </>\n          )}\n        </Pressable>\n      </ScrollView>\n    </KeyboardAvoidingView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  content: {\n    padding: 20,\n  },\n  iconHeader: {\n    alignItems: \"center\",\n    marginBottom: 24,\n  },\n  bigIcon: {\n    width: 72,\n    height: 72,\n    borderRadius: 22,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: 8,\n  },\n  subtitle: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n  },\n  label: {\n    fontSize: 13,\n    fontFamily: \"Inter_600SemiBold\",\n    marginBottom: 6,\n    marginTop: 12,\n  },\n  inputWrapper: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderRadius: 14,\n    paddingHorizontal: 14,\n    height: 52,\n    borderWidth: 1,\n  },\n  inputIcon: {\n    marginRight: 10,\n  },\n  input: {\n    flex: 1,\n    fontSize: 15,\n    fontFamily: \"Inter_400Regular\",\n  },\n  intervalRow: {\n    flexDirection: \"row\",\n    gap: 8,\n    marginTop: 4,\n  },\n  intervalChip: {\n    flex: 1,\n    height: 44,\n    borderRadius: 12,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderWidth: 2,\n  },\n  intervalText: {\n    fontSize: 15,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  stockRow: {\n    flexDirection: \"row\",\n    gap: 12,\n  },\n  stockField: {\n    flex: 1,\n  },\n  infoBox: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderRadius: 12,\n    padding: 12,\n    marginTop: 16,\n    gap: 8,\n  },\n  infoText: {\n    flex: 1,\n    fontSize: 13,\n    fontFamily: \"Inter_400Regular\",\n  },\n  saveBtn: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderRadius: 14,\n    height: 52,\n    marginTop: 24,\n    gap: 8,\n  },\n  saveBtnPressed: {\n    opacity: 0.85,\n    transform: [{ scale: 0.98 }],\n  },\n  saveBtnDisabled: {\n    opacity: 0.6,\n  },\n  saveBtnText: {\n    fontSize: 16,\n    fontFamily: \"Inter_600SemiBold\",\n    color: \"#fff\",\n  },\n});\n","path":null,"size_bytes":9346,"size_tokens":null},"babel.config.js":{"content":"module.exports = function (api) {\n  api.cache(true);\n  return {\n    presets: [[\"babel-preset-expo\", { unstable_transformImportMeta: true }]],\n  };\n};\n","path":null,"size_bytes":150,"size_tokens":null},"app/register.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  TextInput,\n  Pressable,\n  StyleSheet,\n  ActivityIndicator,\n  Alert,\n  Platform,\n  KeyboardAvoidingView,\n  ScrollView,\n} from \"react-native\";\nimport { router } from \"expo-router\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport { LinearGradient } from \"expo-linear-gradient\";\nimport Colors from \"@/constants/colors\";\nimport { useAuth } from \"@/lib/auth-context\";\n\nconst roles = [\n  { key: \"MASTER\", label: \"Responsavel\", icon: \"shield-checkmark-outline\" as const, desc: \"Monitora dependentes\" },\n  { key: \"DEPENDENT\", label: \"Dependente\", icon: \"person-outline\" as const, desc: \"Toma medicamentos\" },\n  { key: \"CONTROLLER\", label: \"Controle\", icon: \"eye-outline\" as const, desc: \"Recebe alertas\" },\n];\n\nexport default function RegisterScreen() {\n  const { register } = useAuth();\n  const insets = useSafeAreaInsets();\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [role, setRole] = useState(\"DEPENDENT\");\n  const [loading, setLoading] = useState(false);\n\n  const handleRegister = async () => {\n    if (!name.trim() || !email.trim() || !password.trim()) {\n      Alert.alert(\"Erro\", \"Preencha todos os campos\");\n      return;\n    }\n    if (password.length < 6) {\n      Alert.alert(\"Erro\", \"Senha deve ter no minimo 6 caracteres\");\n      return;\n    }\n    setLoading(true);\n    try {\n      await register(name.trim(), email.trim(), password, role);\n      router.replace(\"/(tabs)\");\n    } catch (err: any) {\n      Alert.alert(\"Erro\", err.message || \"Falha ao cadastrar\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <View style={styles.container}>\n      <LinearGradient\n        colors={[Colors.palette.teal600, Colors.palette.teal400]}\n        style={[styles.header, { paddingTop: insets.top + (Platform.OS === \"web\" ? 67 : 0) + 20 }]}\n      >\n        <Pressable onPress={() => router.back()} style={styles.backBtn}>\n          <Ionicons name=\"arrow-back\" size={24} color=\"#fff\" />\n        </Pressable>\n        <Text style={styles.headerTitle}>Criar Conta</Text>\n        <Text style={styles.headerSubtitle}>Junte-se ao MedControl</Text>\n      </LinearGradient>\n\n      <KeyboardAvoidingView\n        behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\n        style={styles.formContainer}\n      >\n        <ScrollView\n          contentContainerStyle={styles.formContent}\n          keyboardShouldPersistTaps=\"handled\"\n          showsVerticalScrollIndicator={false}\n        >\n          <Text style={styles.sectionLabel}>Tipo de perfil</Text>\n          <View style={styles.roleRow}>\n            {roles.map((r) => (\n              <Pressable\n                key={r.key}\n                style={[styles.roleCard, role === r.key && styles.roleCardActive]}\n                onPress={() => setRole(r.key)}\n              >\n                <Ionicons\n                  name={r.icon}\n                  size={22}\n                  color={role === r.key ? Colors.light.tint : Colors.light.textSecondary}\n                />\n                <Text style={[styles.roleLabel, role === r.key && styles.roleLabelActive]}>\n                  {r.label}\n                </Text>\n                <Text style={styles.roleDesc}>{r.desc}</Text>\n              </Pressable>\n            ))}\n          </View>\n\n          <View style={styles.inputWrapper}>\n            <Ionicons name=\"person-outline\" size={20} color={Colors.light.textSecondary} style={styles.inputIcon} />\n            <TextInput\n              style={styles.input}\n              placeholder=\"Nome completo\"\n              placeholderTextColor={Colors.light.textSecondary}\n              value={name}\n              onChangeText={setName}\n            />\n          </View>\n\n          <View style={styles.inputWrapper}>\n            <Ionicons name=\"mail-outline\" size={20} color={Colors.light.textSecondary} style={styles.inputIcon} />\n            <TextInput\n              style={styles.input}\n              placeholder=\"Email\"\n              placeholderTextColor={Colors.light.textSecondary}\n              value={email}\n              onChangeText={setEmail}\n              keyboardType=\"email-address\"\n              autoCapitalize=\"none\"\n              autoCorrect={false}\n            />\n          </View>\n\n          <View style={styles.inputWrapper}>\n            <Ionicons name=\"lock-closed-outline\" size={20} color={Colors.light.textSecondary} style={styles.inputIcon} />\n            <TextInput\n              style={styles.input}\n              placeholder=\"Senha (min. 6 caracteres)\"\n              placeholderTextColor={Colors.light.textSecondary}\n              value={password}\n              onChangeText={setPassword}\n              secureTextEntry\n            />\n          </View>\n\n          <Pressable\n            style={({ pressed }) => [styles.registerBtn, pressed && styles.btnPressed, loading && styles.btnDisabled]}\n            onPress={handleRegister}\n            disabled={loading}\n          >\n            {loading ? (\n              <ActivityIndicator color=\"#fff\" />\n            ) : (\n              <Text style={styles.registerBtnText}>Cadastrar</Text>\n            )}\n          </Pressable>\n\n          <Pressable onPress={() => router.back()} style={styles.loginLink}>\n            <Text style={styles.loginLinkText}>Ja tem conta? </Text>\n            <Text style={styles.loginLinkBold}>Entrar</Text>\n          </Pressable>\n        </ScrollView>\n      </KeyboardAvoidingView>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: Colors.light.background,\n  },\n  header: {\n    paddingBottom: 24,\n    paddingHorizontal: 24,\n    borderBottomLeftRadius: 32,\n    borderBottomRightRadius: 32,\n  },\n  backBtn: {\n    width: 40,\n    height: 40,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: 8,\n  },\n  headerTitle: {\n    fontSize: 24,\n    fontFamily: \"Inter_700Bold\",\n    color: \"#fff\",\n    marginBottom: 4,\n  },\n  headerSubtitle: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n    color: \"rgba(255,255,255,0.85)\",\n  },\n  formContainer: {\n    flex: 1,\n  },\n  formContent: {\n    padding: 24,\n    paddingTop: 20,\n    paddingBottom: 40,\n  },\n  sectionLabel: {\n    fontSize: 13,\n    fontFamily: \"Inter_600SemiBold\",\n    color: Colors.light.textSecondary,\n    textTransform: \"uppercase\" as const,\n    letterSpacing: 0.5,\n    marginBottom: 10,\n  },\n  roleRow: {\n    flexDirection: \"row\",\n    gap: 10,\n    marginBottom: 20,\n  },\n  roleCard: {\n    flex: 1,\n    backgroundColor: Colors.light.surface,\n    borderRadius: 14,\n    padding: 12,\n    alignItems: \"center\",\n    borderWidth: 2,\n    borderColor: Colors.light.border,\n    gap: 4,\n  },\n  roleCardActive: {\n    borderColor: Colors.light.tint,\n    backgroundColor: Colors.light.tintLight,\n  },\n  roleLabel: {\n    fontSize: 12,\n    fontFamily: \"Inter_600SemiBold\",\n    color: Colors.light.text,\n  },\n  roleLabelActive: {\n    color: Colors.light.tint,\n  },\n  roleDesc: {\n    fontSize: 10,\n    fontFamily: \"Inter_400Regular\",\n    color: Colors.light.textSecondary,\n    textAlign: \"center\" as const,\n  },\n  inputWrapper: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    backgroundColor: Colors.light.inputBg,\n    borderRadius: 14,\n    marginBottom: 14,\n    paddingHorizontal: 14,\n    height: 52,\n    borderWidth: 1,\n    borderColor: Colors.light.border,\n  },\n  inputIcon: {\n    marginRight: 10,\n  },\n  input: {\n    flex: 1,\n    fontSize: 15,\n    fontFamily: \"Inter_400Regular\",\n    color: Colors.light.text,\n  },\n  registerBtn: {\n    backgroundColor: Colors.light.tint,\n    borderRadius: 14,\n    height: 52,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginTop: 10,\n  },\n  btnPressed: {\n    opacity: 0.85,\n    transform: [{ scale: 0.98 }],\n  },\n  btnDisabled: {\n    opacity: 0.6,\n  },\n  registerBtnText: {\n    color: \"#fff\",\n    fontSize: 16,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  loginLink: {\n    flexDirection: \"row\",\n    justifyContent: \"center\",\n    marginTop: 24,\n  },\n  loginLinkText: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n    color: Colors.light.textSecondary,\n  },\n  loginLinkBold: {\n    fontSize: 14,\n    fontFamily: \"Inter_600SemiBold\",\n    color: Colors.light.tint,\n  },\n});\n","path":null,"size_bytes":8337,"size_tokens":null},"app/edit-medication.tsx":{"content":"import React, { useState, useEffect } from \"react\";\nimport {\n  View,\n  Text,\n  TextInput,\n  Pressable,\n  StyleSheet,\n  Alert,\n  ActivityIndicator,\n  ScrollView,\n  Platform,\n  KeyboardAvoidingView,\n} from \"react-native\";\nimport { router, useLocalSearchParams } from \"expo-router\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport * as Haptics from \"expo-haptics\";\nimport Colors from \"@/constants/colors\";\nimport { apiRequest, queryClient } from \"@/lib/query-client\";\nimport { useTheme } from \"@/lib/theme-context\";\n\nconst intervals = [\n  { label: \"4h\", value: 4 },\n  { label: \"6h\", value: 6 },\n  { label: \"8h\", value: 8 },\n  { label: \"12h\", value: 12 },\n  { label: \"24h\", value: 24 },\n];\n\ninterface Medication {\n  id: string;\n  name: string;\n  dosage: string;\n  currentStock: number;\n  alertThreshold: number;\n  intervalInHours: number;\n  ownerId: string;\n}\n\nexport default function EditMedicationScreen() {\n  const insets = useSafeAreaInsets();\n  const { id } = useLocalSearchParams<{ id: string }>();\n  const { isDark } = useTheme();\n  const colors = isDark ? Colors.dark : Colors.light;\n\n  const [name, setName] = useState(\"\");\n  const [dosage, setDosage] = useState(\"\");\n  const [currentStock, setCurrentStock] = useState(\"\");\n  const [alertThreshold, setAlertThreshold] = useState(\"\");\n  const [intervalInHours, setIntervalInHours] = useState(8);\n  const [loaded, setLoaded] = useState(false);\n\n  const medQuery = useQuery<Medication>({\n    queryKey: [\"/api/medications\", id],\n    enabled: !!id,\n  });\n\n  useEffect(() => {\n    if (medQuery.data && !loaded) {\n      const med = medQuery.data;\n      setName(med.name);\n      setDosage(med.dosage);\n      setCurrentStock(String(med.currentStock));\n      setAlertThreshold(String(med.alertThreshold));\n      setIntervalInHours(med.intervalInHours);\n      setLoaded(true);\n    }\n  }, [medQuery.data, loaded]);\n\n  const updateMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"PATCH\", `/api/medications/${id}`, {\n        name: name.trim(),\n        dosage: dosage.trim(),\n        currentStock: parseInt(currentStock, 10) || 0,\n        alertThreshold: parseInt(alertThreshold, 10) || 0,\n        intervalInHours,\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      queryClient.invalidateQueries({ queryKey: [\"/api/medications\"] });\n      router.back();\n    },\n    onError: (err: any) => {\n      Alert.alert(\"Erro\", err.message || \"Falha ao atualizar medicamento\");\n    },\n  });\n\n  const handleSave = () => {\n    if (!name.trim()) {\n      Alert.alert(\"Erro\", \"Informe o nome do medicamento\");\n      return;\n    }\n    if (!dosage.trim()) {\n      Alert.alert(\"Erro\", \"Informe a dosagem\");\n      return;\n    }\n    updateMutation.mutate();\n  };\n\n  const handleAddStock = () => {\n    Haptics.selectionAsync();\n    const current = parseInt(currentStock, 10) || 0;\n    Alert.prompt\n      ? Alert.prompt(\n          \"Adicionar estoque\",\n          \"Quantas unidades deseja adicionar?\",\n          [\n            { text: \"Cancelar\", style: \"cancel\" },\n            {\n              text: \"Adicionar\",\n              onPress: (val: string | undefined) => {\n                const add = parseInt(val || \"0\", 10);\n                if (add > 0) setCurrentStock(String(current + add));\n              },\n            },\n          ],\n          \"plain-text\",\n          \"\",\n          \"number-pad\"\n        )\n      : setCurrentStock(String(current + 10));\n  };\n\n  if (medQuery.isLoading) {\n    return (\n      <View style={[styles.container, styles.loadingContainer, { backgroundColor: colors.background }]}>\n        <ActivityIndicator size=\"large\" color={colors.tint} />\n      </View>\n    );\n  }\n\n  return (\n    <KeyboardAvoidingView\n      style={[styles.container, { backgroundColor: colors.background }]}\n      behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\n      keyboardVerticalOffset={90}\n    >\n      <ScrollView\n        contentContainerStyle={[styles.content, { paddingBottom: insets.bottom + (Platform.OS === \"web\" ? 34 : 0) + 24 }]}\n        keyboardShouldPersistTaps=\"handled\"\n        showsVerticalScrollIndicator={false}\n      >\n        <View style={styles.iconHeader}>\n          <View style={[styles.bigIcon, { backgroundColor: colors.tintLight }]}>\n            <Ionicons name=\"create\" size={36} color={colors.tint} />\n          </View>\n          <Text style={[styles.subtitle, { color: colors.textSecondary }]}>Edite os detalhes do medicamento</Text>\n        </View>\n\n        <Text style={[styles.label, { color: colors.text }]}>Nome do medicamento</Text>\n        <View style={[styles.inputWrapper, { backgroundColor: colors.surface, borderColor: colors.border }]}>\n          <Ionicons name=\"medkit-outline\" size={18} color={colors.textSecondary} style={styles.inputIcon} />\n          <TextInput\n            style={[styles.input, { color: colors.text }]}\n            placeholder=\"Ex: Dipirona\"\n            placeholderTextColor={colors.textSecondary}\n            value={name}\n            onChangeText={setName}\n          />\n        </View>\n\n        <Text style={[styles.label, { color: colors.text }]}>Dosagem</Text>\n        <View style={[styles.inputWrapper, { backgroundColor: colors.surface, borderColor: colors.border }]}>\n          <Ionicons name=\"flask-outline\" size={18} color={colors.textSecondary} style={styles.inputIcon} />\n          <TextInput\n            style={[styles.input, { color: colors.text }]}\n            placeholder=\"Ex: 500mg, 1 comprimido\"\n            placeholderTextColor={colors.textSecondary}\n            value={dosage}\n            onChangeText={setDosage}\n          />\n        </View>\n\n        <Text style={[styles.label, { color: colors.text }]}>Intervalo entre doses</Text>\n        <View style={styles.intervalRow}>\n          {intervals.map((i) => (\n            <Pressable\n              key={i.value}\n              style={[\n                styles.intervalChip,\n                { backgroundColor: colors.surface, borderColor: colors.border },\n                intervalInHours === i.value && { borderColor: colors.tint, backgroundColor: colors.tintLight },\n              ]}\n              onPress={() => {\n                Haptics.selectionAsync();\n                setIntervalInHours(i.value);\n              }}\n            >\n              <Text style={[styles.intervalText, { color: colors.textSecondary }, intervalInHours === i.value && { color: colors.tint }]}>\n                {i.label}\n              </Text>\n            </Pressable>\n          ))}\n        </View>\n\n        <View style={styles.stockRow}>\n          <View style={styles.stockField}>\n            <Text style={[styles.label, { color: colors.text }]}>Estoque atual</Text>\n            <View style={styles.stockInputRow}>\n              <View style={[styles.inputWrapper, { flex: 1, backgroundColor: colors.surface, borderColor: colors.border }]}>\n                <Ionicons name=\"cube-outline\" size={18} color={colors.textSecondary} style={styles.inputIcon} />\n                <TextInput\n                  style={[styles.input, { color: colors.text }]}\n                  placeholder=\"0\"\n                  placeholderTextColor={colors.textSecondary}\n                  value={currentStock}\n                  onChangeText={setCurrentStock}\n                  keyboardType=\"number-pad\"\n                />\n              </View>\n              <Pressable\n                style={({ pressed }) => [styles.addStockBtn, { backgroundColor: colors.tintLight, borderColor: colors.tint }, pressed && { opacity: 0.7 }]}\n                onPress={handleAddStock}\n              >\n                <Ionicons name=\"add\" size={22} color={colors.tint} />\n              </Pressable>\n            </View>\n          </View>\n\n          <View style={styles.stockField}>\n            <Text style={[styles.label, { color: colors.text }]}>Alerta em</Text>\n            <View style={[styles.inputWrapper, { backgroundColor: colors.surface, borderColor: colors.border }]}>\n              <Ionicons name=\"notifications-outline\" size={18} color={colors.textSecondary} style={styles.inputIcon} />\n              <TextInput\n                style={[styles.input, { color: colors.text }]}\n                placeholder=\"5\"\n                placeholderTextColor={colors.textSecondary}\n                value={alertThreshold}\n                onChangeText={setAlertThreshold}\n                keyboardType=\"number-pad\"\n              />\n            </View>\n          </View>\n        </View>\n\n        <View style={[styles.infoBox, { backgroundColor: colors.tintLight }]}>\n          <Ionicons name=\"information-circle-outline\" size={18} color={colors.tint} />\n          <Text style={[styles.infoText, { color: colors.tint }]}>\n            Voce sera alertado quando o estoque atingir {alertThreshold || \"5\"} unidades\n          </Text>\n        </View>\n\n        <Pressable\n          style={({ pressed }) => [\n            styles.saveBtn,\n            { backgroundColor: colors.tint },\n            pressed && styles.saveBtnPressed,\n            updateMutation.isPending && styles.saveBtnDisabled,\n          ]}\n          onPress={handleSave}\n          disabled={updateMutation.isPending}\n        >\n          {updateMutation.isPending ? (\n            <ActivityIndicator color=\"#fff\" />\n          ) : (\n            <>\n              <Ionicons name=\"checkmark\" size={22} color=\"#fff\" />\n              <Text style={styles.saveBtnText}>Salvar Alteracoes</Text>\n            </>\n          )}\n        </Pressable>\n      </ScrollView>\n    </KeyboardAvoidingView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  loadingContainer: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  content: {\n    padding: 20,\n  },\n  iconHeader: {\n    alignItems: \"center\",\n    marginBottom: 24,\n  },\n  bigIcon: {\n    width: 72,\n    height: 72,\n    borderRadius: 22,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: 8,\n  },\n  subtitle: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n  },\n  label: {\n    fontSize: 13,\n    fontFamily: \"Inter_600SemiBold\",\n    marginBottom: 6,\n    marginTop: 12,\n  },\n  inputWrapper: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderRadius: 14,\n    paddingHorizontal: 14,\n    height: 52,\n    borderWidth: 1,\n  },\n  inputIcon: {\n    marginRight: 10,\n  },\n  input: {\n    flex: 1,\n    fontSize: 15,\n    fontFamily: \"Inter_400Regular\",\n  },\n  intervalRow: {\n    flexDirection: \"row\",\n    gap: 8,\n    marginTop: 4,\n  },\n  intervalChip: {\n    flex: 1,\n    height: 44,\n    borderRadius: 12,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderWidth: 2,\n  },\n  intervalText: {\n    fontSize: 15,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  stockRow: {\n    flexDirection: \"row\",\n    gap: 12,\n  },\n  stockField: {\n    flex: 1,\n  },\n  stockInputRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: 8,\n  },\n  addStockBtn: {\n    width: 44,\n    height: 52,\n    borderRadius: 14,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderWidth: 1,\n  },\n  infoBox: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderRadius: 12,\n    padding: 12,\n    marginTop: 16,\n    gap: 8,\n  },\n  infoText: {\n    flex: 1,\n    fontSize: 13,\n    fontFamily: \"Inter_400Regular\",\n  },\n  saveBtn: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderRadius: 14,\n    height: 52,\n    marginTop: 24,\n    gap: 8,\n  },\n  saveBtnPressed: {\n    opacity: 0.85,\n    transform: [{ scale: 0.98 }],\n  },\n  saveBtnDisabled: {\n    opacity: 0.6,\n  },\n  saveBtnText: {\n    fontSize: 16,\n    fontFamily: \"Inter_600SemiBold\",\n    color: \"#fff\",\n  },\n});\n","path":null,"size_bytes":11811,"size_tokens":null},"app/(tabs)/profile.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  StyleSheet,\n  Pressable,\n  Alert,\n  ScrollView,\n  Platform,\n  ActivityIndicator,\n  Modal,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport { router } from \"expo-router\";\nimport * as Haptics from \"expo-haptics\";\nimport * as Clipboard from \"expo-clipboard\";\nimport Colors from \"@/constants/colors\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { useTheme } from \"@/lib/theme-context\";\nimport { apiRequest } from \"@/lib/query-client\";\n\nconst ROLES = [\n  { key: \"MASTER\", label: \"Responsavel\", icon: \"shield-checkmark\" },\n  { key: \"DEPENDENT\", label: \"Dependente\", icon: \"person\" },\n  { key: \"CONTROLLER\", label: \"Controle\", icon: \"eye\" },\n] as const;\n\nexport default function ProfileScreen() {\n  const { user, logout, refreshUser } = useAuth();\n  const { theme, setTheme, isDark } = useTheme();\n  const insets = useSafeAreaInsets();\n  const colors = isDark ? Colors.dark : Colors.light;\n\n  const [rolePickerVisible, setRolePickerVisible] = useState(false);\n  const [changingRole, setChangingRole] = useState(false);\n  const [upgrading, setUpgrading] = useState(false);\n  const [themePickerVisible, setThemePickerVisible] = useState(false);\n\n  const handleLogout = () => {\n    Alert.alert(\"Sair\", \"Deseja realmente sair?\", [\n      { text: \"Cancelar\", style: \"cancel\" },\n      {\n        text: \"Sair\",\n        style: \"destructive\",\n        onPress: async () => {\n          Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n          await logout();\n          router.replace(\"/login\");\n        },\n      },\n    ]);\n  };\n\n  const handleCopyId = async () => {\n    if (!user?.id) return;\n    await Clipboard.setStringAsync(user.id);\n    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n    Alert.alert(\"Copiado\", \"Seu ID foi copiado para a area de transferencia.\");\n  };\n\n  const handleOpenEdit = () => {\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    router.push(\"/edit-profile\");\n  };\n\n  const handleRoleTagPress = () => {\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    setRolePickerVisible(true);\n  };\n\n  const handleSelectRole = (roleKey: string) => {\n    if (roleKey === user?.role) {\n      setRolePickerVisible(false);\n      return;\n    }\n    Alert.alert(\n      \"Alterar Funcao\",\n      \"Mudar sua funcao afeta suas permissoes no app. Deseja continuar?\",\n      [\n        { text: \"Cancelar\", style: \"cancel\" },\n        {\n          text: \"Confirmar\",\n          onPress: async () => {\n            setChangingRole(true);\n            try {\n              await apiRequest(\"PATCH\", \"/api/auth/role\", { role: roleKey });\n              await refreshUser();\n              Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n              setRolePickerVisible(false);\n            } catch (e: any) {\n              Alert.alert(\"Erro\", e.message || \"Nao foi possivel alterar a funcao.\");\n            } finally {\n              setChangingRole(false);\n            }\n          },\n        },\n      ]\n    );\n  };\n\n  const handlePlanPress = () => {\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    if (user?.planType === \"PREMIUM\") {\n      Alert.alert(\"Plano Premium\", \"Voce ja e um usuario Premium!\");\n      return;\n    }\n    Alert.alert(\n      \"Upgrade para Premium\",\n      \"Desbloqueie recursos ilimitados, conexoes e muito mais por R$9,90/mes.\",\n      [\n        { text: \"Cancelar\", style: \"cancel\" },\n        {\n          text: \"Fazer Upgrade\",\n          onPress: async () => {\n            setUpgrading(true);\n            try {\n              await apiRequest(\"POST\", \"/api/auth/upgrade\");\n              await refreshUser();\n              Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n              Alert.alert(\"Sucesso\", \"Parabens! Seu plano foi atualizado para Premium.\");\n            } catch (e: any) {\n              Alert.alert(\"Erro\", e.message || \"Nao foi possivel realizar o upgrade.\");\n            } finally {\n              setUpgrading(false);\n            }\n          },\n        },\n      ]\n    );\n  };\n\n  const handleConnectionsPress = () => {\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    router.push(\"/connections\");\n  };\n\n  const handleThemePress = () => {\n    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n    setThemePickerVisible(true);\n  };\n\n  const roleInfo = ROLES.find((r) => r.key === user?.role) || ROLES[0];\n\n  return (\n    <View style={[styles.container, { backgroundColor: colors.background }]}>\n      <View style={[styles.header, { paddingTop: insets.top + (Platform.OS === \"web\" ? 67 : 0) + 8, backgroundColor: colors.surface, borderBottomColor: colors.border }]}>\n        <Text style={[styles.headerTitle, { color: colors.text }]}>Perfil</Text>\n      </View>\n\n      <ScrollView contentContainerStyle={[styles.content, { paddingBottom: insets.bottom + (Platform.OS === \"web\" ? 34 : 0) + 100 }]} showsVerticalScrollIndicator={false}>\n        <View style={[styles.profileCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n          <View style={styles.avatarContainer}>\n            <View style={[styles.avatar, { backgroundColor: colors.tint }]}>\n              <Text style={styles.avatarText}>\n                {user?.name?.charAt(0)?.toUpperCase() || \"U\"}\n              </Text>\n            </View>\n          </View>\n          <Text style={[styles.profileName, { color: colors.text }]}>{user?.name}</Text>\n          <Text style={[styles.profileEmail, { color: colors.textSecondary }]}>{user?.email}</Text>\n          <Pressable onPress={handleRoleTagPress}>\n            <View style={[styles.roleTag, { backgroundColor: colors.tintLight }]}>\n              <Ionicons name={roleInfo.icon as any} size={14} color={colors.tint} />\n              <Text style={[styles.roleTagText, { color: colors.tint }]}>{roleInfo.label}</Text>\n              <Ionicons name=\"chevron-down\" size={12} color={colors.tint} />\n            </View>\n          </Pressable>\n        </View>\n\n        <View style={styles.section}>\n          <Text style={[styles.sectionTitle, { color: colors.textSecondary }]}>Conta</Text>\n\n          <View style={[styles.menuCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n            <Pressable style={styles.menuItem} onPress={handleOpenEdit}>\n              <View style={[styles.menuIcon, { backgroundColor: colors.tintLight }]}>\n                <Ionicons name=\"person-outline\" size={18} color={colors.tint} />\n              </View>\n              <Text style={[styles.menuLabel, { color: colors.text }]}>Editar Perfil</Text>\n              <Ionicons name=\"chevron-forward\" size={18} color={colors.textSecondary} />\n            </Pressable>\n\n            <View style={[styles.menuDivider, { backgroundColor: colors.border }]} />\n\n            <Pressable style={styles.menuItem} onPress={handlePlanPress} disabled={upgrading}>\n              <View style={[styles.menuIcon, { backgroundColor: colors.warningLight }]}>\n                <Ionicons name=\"star-outline\" size={18} color={colors.warning} />\n              </View>\n              <View style={styles.menuLabelRow}>\n                <Text style={[styles.menuLabel, { color: colors.text }]}>Plano</Text>\n                <View style={[styles.planBadge, user?.planType === \"PREMIUM\" && { backgroundColor: colors.successLight }]}>\n                  {upgrading ? (\n                    <ActivityIndicator size={10} color={colors.warning} />\n                  ) : (\n                    <Text style={[styles.planBadgeText, { color: colors.warning }, user?.planType === \"PREMIUM\" && { color: colors.success }]}>\n                      {user?.planType || \"FREE\"}\n                    </Text>\n                  )}\n                </View>\n              </View>\n              <Ionicons name=\"chevron-forward\" size={18} color={colors.textSecondary} />\n            </Pressable>\n\n            <View style={[styles.menuDivider, { backgroundColor: colors.border }]} />\n\n            <Pressable style={styles.menuItem} onPress={handleConnectionsPress}>\n              <View style={[styles.menuIcon, { backgroundColor: colors.tintLight }]}>\n                <Ionicons name=\"people-outline\" size={18} color={colors.tint} />\n              </View>\n              <Text style={[styles.menuLabel, { color: colors.text }]}>Conexoes</Text>\n              <Ionicons name=\"chevron-forward\" size={18} color={colors.textSecondary} />\n            </Pressable>\n          </View>\n        </View>\n\n        <View style={styles.section}>\n          <Text style={[styles.sectionTitle, { color: colors.textSecondary }]}>Configuracoes</Text>\n          <View style={[styles.menuCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n            <Pressable style={styles.menuItem} onPress={handleThemePress}>\n              <View style={[styles.menuIcon, { backgroundColor: isDark ? \"rgba(99, 102, 241, 0.15)\" : \"#EEF2FF\" }]}>\n                <Ionicons name={isDark ? \"moon\" : \"sunny\"} size={18} color={isDark ? \"#818CF8\" : \"#F59E0B\"} />\n              </View>\n              <View style={styles.menuLabelRow}>\n                <Text style={[styles.menuLabel, { color: colors.text }]}>Tema</Text>\n                <View style={[styles.themeBadge, { backgroundColor: colors.inputBg }]}>\n                  <Text style={[styles.themeBadgeText, { color: colors.textSecondary }]}>\n                    {isDark ? \"Escuro\" : \"Claro\"}\n                  </Text>\n                </View>\n              </View>\n              <Ionicons name=\"chevron-forward\" size={18} color={colors.textSecondary} />\n            </Pressable>\n          </View>\n        </View>\n\n        <View style={styles.section}>\n          <Text style={[styles.sectionTitle, { color: colors.textSecondary }]}>Info</Text>\n          <View style={[styles.menuCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n            <Pressable style={styles.menuItem} onPress={handleCopyId}>\n              <View style={[styles.menuIcon, { backgroundColor: colors.inputBg }]}>\n                <Ionicons name=\"finger-print-outline\" size={18} color={colors.textSecondary} />\n              </View>\n              <View style={styles.menuLabelRow}>\n                <Text style={[styles.menuLabel, { color: colors.text }]}>Seu ID</Text>\n                <Text style={[styles.idText, { color: colors.textSecondary }]}>{user?.id?.slice(0, 8)}...</Text>\n              </View>\n              <Ionicons name=\"copy-outline\" size={16} color={colors.textSecondary} />\n            </Pressable>\n          </View>\n        </View>\n\n        <Pressable\n          style={({ pressed }) => [styles.logoutBtn, { backgroundColor: colors.dangerLight }, pressed && styles.logoutBtnPressed]}\n          onPress={handleLogout}\n        >\n          <Ionicons name=\"log-out-outline\" size={20} color={colors.danger} />\n          <Text style={[styles.logoutText, { color: colors.danger }]}>Sair da conta</Text>\n        </Pressable>\n      </ScrollView>\n\n      <Modal\n        visible={rolePickerVisible}\n        transparent\n        animationType=\"fade\"\n        onRequestClose={() => setRolePickerVisible(false)}\n      >\n        <Pressable style={styles.modalOverlay} onPress={() => setRolePickerVisible(false)}>\n          <Pressable style={[styles.modalContent, { backgroundColor: colors.surface }]} onPress={() => {}}>\n            <Text style={[styles.modalTitle, { color: colors.text }]}>Selecionar Funcao</Text>\n            <Text style={[styles.modalSubtitle, { color: colors.textSecondary }]}>Escolha sua funcao no app</Text>\n            {ROLES.map((role) => {\n              const isSelected = role.key === user?.role;\n              return (\n                <Pressable\n                  key={role.key}\n                  style={[styles.roleOption, { backgroundColor: colors.inputBg }, isSelected && { backgroundColor: colors.tintLight, borderWidth: 1, borderColor: colors.tint }]}\n                  onPress={() => handleSelectRole(role.key)}\n                  disabled={changingRole}\n                >\n                  <Ionicons name={role.icon as any} size={20} color={isSelected ? colors.tint : colors.textSecondary} />\n                  <View style={styles.roleOptionTextContainer}>\n                    <Text style={[styles.roleOptionLabel, { color: colors.text }, isSelected && { color: colors.tint }]}>\n                      {role.label}\n                    </Text>\n                    <Text style={[styles.roleOptionKey, { color: colors.textSecondary }]}>{role.key}</Text>\n                  </View>\n                  {isSelected && <Ionicons name=\"checkmark-circle\" size={22} color={colors.tint} />}\n                  {changingRole && !isSelected && <ActivityIndicator size=\"small\" color={colors.tint} />}\n                </Pressable>\n              );\n            })}\n            <Pressable\n              style={({ pressed }) => [styles.modalCloseBtn, { backgroundColor: colors.inputBg }, pressed && { opacity: 0.8 }]}\n              onPress={() => setRolePickerVisible(false)}\n            >\n              <Text style={[styles.modalCloseBtnText, { color: colors.textSecondary }]}>Fechar</Text>\n            </Pressable>\n          </Pressable>\n        </Pressable>\n      </Modal>\n\n      <Modal\n        visible={themePickerVisible}\n        transparent\n        animationType=\"fade\"\n        onRequestClose={() => setThemePickerVisible(false)}\n      >\n        <Pressable style={styles.modalOverlay} onPress={() => setThemePickerVisible(false)}>\n          <Pressable style={[styles.modalContent, { backgroundColor: colors.surface }]} onPress={() => {}}>\n            <Text style={[styles.modalTitle, { color: colors.text }]}>Escolher Tema</Text>\n            <Text style={[styles.modalSubtitle, { color: colors.textSecondary }]}>Selecione a aparencia do app</Text>\n\n            <Pressable\n              style={[styles.roleOption, { backgroundColor: colors.inputBg }, theme === \"light\" && { backgroundColor: colors.tintLight, borderWidth: 1, borderColor: colors.tint }]}\n              onPress={() => { setTheme(\"light\"); Haptics.selectionAsync(); setThemePickerVisible(false); }}\n            >\n              <Ionicons name=\"sunny\" size={20} color={theme === \"light\" ? colors.tint : colors.textSecondary} />\n              <View style={styles.roleOptionTextContainer}>\n                <Text style={[styles.roleOptionLabel, { color: colors.text }, theme === \"light\" && { color: colors.tint }]}>Claro</Text>\n                <Text style={[styles.roleOptionKey, { color: colors.textSecondary }]}>Light</Text>\n              </View>\n              {theme === \"light\" && <Ionicons name=\"checkmark-circle\" size={22} color={colors.tint} />}\n            </Pressable>\n\n            <Pressable\n              style={[styles.roleOption, { backgroundColor: colors.inputBg }, theme === \"dark\" && { backgroundColor: colors.tintLight, borderWidth: 1, borderColor: colors.tint }]}\n              onPress={() => { setTheme(\"dark\"); Haptics.selectionAsync(); setThemePickerVisible(false); }}\n            >\n              <Ionicons name=\"moon\" size={20} color={theme === \"dark\" ? colors.tint : colors.textSecondary} />\n              <View style={styles.roleOptionTextContainer}>\n                <Text style={[styles.roleOptionLabel, { color: colors.text }, theme === \"dark\" && { color: colors.tint }]}>Escuro</Text>\n                <Text style={[styles.roleOptionKey, { color: colors.textSecondary }]}>Dark</Text>\n              </View>\n              {theme === \"dark\" && <Ionicons name=\"checkmark-circle\" size={22} color={colors.tint} />}\n            </Pressable>\n\n            <Pressable\n              style={({ pressed }) => [styles.modalCloseBtn, { backgroundColor: colors.inputBg }, pressed && { opacity: 0.8 }]}\n              onPress={() => setThemePickerVisible(false)}\n            >\n              <Text style={[styles.modalCloseBtnText, { color: colors.textSecondary }]}>Fechar</Text>\n            </Pressable>\n          </Pressable>\n        </Pressable>\n      </Modal>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  header: {\n    paddingHorizontal: 20,\n    paddingBottom: 12,\n    borderBottomWidth: 1,\n  },\n  headerTitle: {\n    fontSize: 28,\n    fontFamily: \"Inter_700Bold\",\n  },\n  content: {\n    padding: 20,\n  },\n  profileCard: {\n    borderRadius: 20,\n    padding: 24,\n    alignItems: \"center\",\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 1,\n    shadowRadius: 8,\n    elevation: 2,\n  },\n  avatarContainer: {\n    marginBottom: 12,\n  },\n  avatar: {\n    width: 72,\n    height: 72,\n    borderRadius: 36,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  avatarText: {\n    fontSize: 28,\n    fontFamily: \"Inter_700Bold\",\n    color: \"#fff\",\n  },\n  profileName: {\n    fontSize: 20,\n    fontFamily: \"Inter_700Bold\",\n  },\n  profileEmail: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n    marginTop: 2,\n  },\n  roleTag: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderRadius: 20,\n    paddingHorizontal: 12,\n    paddingVertical: 6,\n    marginTop: 10,\n    gap: 4,\n  },\n  roleTagText: {\n    fontSize: 12,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  section: {\n    marginTop: 24,\n  },\n  sectionTitle: {\n    fontSize: 13,\n    fontFamily: \"Inter_600SemiBold\",\n    textTransform: \"uppercase\" as const,\n    letterSpacing: 0.5,\n    marginBottom: 8,\n    paddingLeft: 4,\n  },\n  menuCard: {\n    borderRadius: 16,\n    overflow: \"hidden\",\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 1,\n    shadowRadius: 8,\n    elevation: 2,\n  },\n  menuItem: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    padding: 14,\n    gap: 12,\n  },\n  menuIcon: {\n    width: 34,\n    height: 34,\n    borderRadius: 10,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  menuLabel: {\n    flex: 1,\n    fontSize: 15,\n    fontFamily: \"Inter_500Medium\",\n  },\n  menuLabelRow: {\n    flex: 1,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: 8,\n  },\n  menuDivider: {\n    height: 1,\n    marginLeft: 60,\n  },\n  planBadge: {\n    backgroundColor: Colors.light.warningLight,\n    borderRadius: 6,\n    paddingHorizontal: 8,\n    paddingVertical: 2,\n  },\n  planBadgeText: {\n    fontSize: 10,\n    fontFamily: \"Inter_700Bold\",\n  },\n  themeBadge: {\n    borderRadius: 6,\n    paddingHorizontal: 8,\n    paddingVertical: 2,\n  },\n  themeBadgeText: {\n    fontSize: 10,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  idText: {\n    fontSize: 12,\n    fontFamily: \"Inter_400Regular\",\n  },\n  logoutBtn: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderRadius: 14,\n    padding: 14,\n    marginTop: 32,\n    gap: 8,\n  },\n  logoutBtnPressed: {\n    opacity: 0.8,\n  },\n  logoutText: {\n    fontSize: 15,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  modalOverlay: {\n    flex: 1,\n    backgroundColor: \"rgba(0,0,0,0.4)\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    padding: 24,\n  },\n  modalContent: {\n    borderRadius: 20,\n    padding: 24,\n    width: \"100%\",\n    maxWidth: 360,\n  },\n  modalTitle: {\n    fontSize: 18,\n    fontFamily: \"Inter_700Bold\",\n    marginBottom: 4,\n  },\n  modalSubtitle: {\n    fontSize: 13,\n    fontFamily: \"Inter_400Regular\",\n    marginBottom: 20,\n  },\n  roleOption: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    padding: 14,\n    borderRadius: 12,\n    marginBottom: 8,\n    gap: 12,\n  },\n  roleOptionTextContainer: {\n    flex: 1,\n  },\n  roleOptionLabel: {\n    fontSize: 15,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  roleOptionKey: {\n    fontSize: 11,\n    fontFamily: \"Inter_400Regular\",\n    marginTop: 1,\n  },\n  modalCloseBtn: {\n    borderRadius: 12,\n    padding: 14,\n    alignItems: \"center\",\n    marginTop: 8,\n  },\n  modalCloseBtnText: {\n    fontSize: 15,\n    fontFamily: \"Inter_500Medium\",\n  },\n});\n","path":null,"size_bytes":19838,"size_tokens":null},"app/edit-profile.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  TextInput,\n  Pressable,\n  StyleSheet,\n  Alert,\n  ActivityIndicator,\n  ScrollView,\n  Platform,\n  KeyboardAvoidingView,\n} from \"react-native\";\nimport { router } from \"expo-router\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport * as Haptics from \"expo-haptics\";\nimport Colors from \"@/constants/colors\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { useTheme } from \"@/lib/theme-context\";\nimport { apiRequest } from \"@/lib/query-client\";\n\nexport default function EditProfileScreen() {\n  const { user, refreshUser } = useAuth();\n  const { isDark } = useTheme();\n  const insets = useSafeAreaInsets();\n  const colors = isDark ? Colors.dark : Colors.light;\n\n  const [name, setName] = useState(user?.name || \"\");\n  const [email, setEmail] = useState(user?.email || \"\");\n  const [saving, setSaving] = useState(false);\n\n  const handleSave = async () => {\n    if (!name.trim() || !email.trim()) {\n      Alert.alert(\"Erro\", \"Nome e email sao obrigatorios.\");\n      return;\n    }\n    setSaving(true);\n    try {\n      await apiRequest(\"PATCH\", \"/api/auth/profile\", {\n        name: name.trim(),\n        email: email.trim(),\n      });\n      await refreshUser();\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      router.back();\n    } catch (e: any) {\n      Alert.alert(\"Erro\", e.message || \"Nao foi possivel salvar o perfil.\");\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  return (\n    <KeyboardAvoidingView\n      style={[styles.container, { backgroundColor: colors.background }]}\n      behavior={Platform.OS === \"ios\" ? \"padding\" : \"height\"}\n      keyboardVerticalOffset={90}\n    >\n      <ScrollView\n        contentContainerStyle={[styles.content, { paddingBottom: insets.bottom + (Platform.OS === \"web\" ? 34 : 0) + 24 }]}\n        keyboardShouldPersistTaps=\"handled\"\n        showsVerticalScrollIndicator={false}\n      >\n        <View style={styles.iconHeader}>\n          <View style={[styles.bigIcon, { backgroundColor: colors.tintLight }]}>\n            <Ionicons name=\"person\" size={36} color={colors.tint} />\n          </View>\n          <Text style={[styles.subtitle, { color: colors.textSecondary }]}>Atualize suas informacoes pessoais</Text>\n        </View>\n\n        <Text style={[styles.label, { color: colors.text }]}>Nome</Text>\n        <View style={[styles.inputWrapper, { backgroundColor: colors.surface, borderColor: colors.border }]}>\n          <Ionicons name=\"person-outline\" size={18} color={colors.textSecondary} style={styles.inputIcon} />\n          <TextInput\n            style={[styles.input, { color: colors.text }]}\n            value={name}\n            onChangeText={setName}\n            placeholder=\"Seu nome completo\"\n            placeholderTextColor={colors.textSecondary}\n            autoCapitalize=\"words\"\n          />\n        </View>\n\n        <Text style={[styles.label, { color: colors.text }]}>Email</Text>\n        <View style={[styles.inputWrapper, { backgroundColor: colors.surface, borderColor: colors.border }]}>\n          <Ionicons name=\"mail-outline\" size={18} color={colors.textSecondary} style={styles.inputIcon} />\n          <TextInput\n            style={[styles.input, { color: colors.text }]}\n            value={email}\n            onChangeText={setEmail}\n            placeholder=\"Seu email\"\n            placeholderTextColor={colors.textSecondary}\n            keyboardType=\"email-address\"\n            autoCapitalize=\"none\"\n          />\n        </View>\n\n        <View style={[styles.infoBox, { backgroundColor: colors.tintLight }]}>\n          <Ionicons name=\"information-circle-outline\" size={18} color={colors.tint} />\n          <Text style={[styles.infoText, { color: colors.tint }]}>\n            Essas informacoes sao usadas para identificar voce no app\n          </Text>\n        </View>\n\n        <Pressable\n          style={({ pressed }) => [\n            styles.saveBtn,\n            { backgroundColor: colors.tint },\n            pressed && styles.saveBtnPressed,\n            saving && styles.saveBtnDisabled,\n          ]}\n          onPress={handleSave}\n          disabled={saving}\n        >\n          {saving ? (\n            <ActivityIndicator color=\"#fff\" />\n          ) : (\n            <>\n              <Ionicons name=\"checkmark\" size={22} color=\"#fff\" />\n              <Text style={styles.saveBtnText}>Salvar Alteracoes</Text>\n            </>\n          )}\n        </Pressable>\n      </ScrollView>\n    </KeyboardAvoidingView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  content: {\n    padding: 20,\n  },\n  iconHeader: {\n    alignItems: \"center\",\n    marginBottom: 24,\n  },\n  bigIcon: {\n    width: 72,\n    height: 72,\n    borderRadius: 22,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: 8,\n  },\n  subtitle: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n  },\n  label: {\n    fontSize: 13,\n    fontFamily: \"Inter_600SemiBold\",\n    marginBottom: 6,\n    marginTop: 12,\n  },\n  inputWrapper: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderRadius: 14,\n    paddingHorizontal: 14,\n    height: 52,\n    borderWidth: 1,\n  },\n  inputIcon: {\n    marginRight: 10,\n  },\n  input: {\n    flex: 1,\n    fontSize: 15,\n    fontFamily: \"Inter_400Regular\",\n  },\n  infoBox: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderRadius: 12,\n    padding: 12,\n    marginTop: 16,\n    gap: 8,\n  },\n  infoText: {\n    flex: 1,\n    fontSize: 13,\n    fontFamily: \"Inter_400Regular\",\n  },\n  saveBtn: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    borderRadius: 14,\n    height: 52,\n    marginTop: 24,\n    gap: 8,\n  },\n  saveBtnPressed: {\n    opacity: 0.85,\n    transform: [{ scale: 0.98 }],\n  },\n  saveBtnDisabled: {\n    opacity: 0.6,\n  },\n  saveBtnText: {\n    fontSize: 16,\n    fontFamily: \"Inter_600SemiBold\",\n    color: \"#fff\",\n  },\n});\n","path":null,"size_bytes":5957,"size_tokens":null},"metro.config.js":{"content":"const { getDefaultConfig } = require(\"expo/metro-config\");\n\nconst config = getDefaultConfig(__dirname);\n\nmodule.exports = config;\n","path":null,"size_bytes":130,"size_tokens":null},"app/index.tsx":{"content":"import { useEffect } from \"react\";\nimport { View, ActivityIndicator } from \"react-native\";\nimport { router } from \"expo-router\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport Colors from \"@/constants/colors\";\nimport { useTheme } from \"@/lib/theme-context\";\n\nexport default function IndexScreen() {\n  const { user, isLoading } = useAuth();\n  const { isDark } = useTheme();\n  const colors = isDark ? Colors.dark : Colors.light;\n\n  useEffect(() => {\n    if (isLoading) return;\n    if (user) {\n      router.replace(\"/(tabs)\");\n    } else {\n      router.replace(\"/login\");\n    }\n  }, [user, isLoading]);\n\n  return (\n    <View style={{ flex: 1, alignItems: \"center\", justifyContent: \"center\", backgroundColor: colors.background }}>\n      <ActivityIndicator size=\"large\" color={colors.tint} />\n    </View>\n  );\n}\n","path":null,"size_bytes":813,"size_tokens":null},"scripts/build.js":{"content":"const fs = require(\"fs\");\nconst path = require(\"path\");\nconst { spawn } = require(\"child_process\");\nconst { Readable } = require(\"stream\");\nconst { pipeline } = require(\"stream/promises\");\n\nlet metroProcess = null;\n\nfunction exitWithError(message) {\n  console.error(message);\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(1);\n}\n\nfunction setupSignalHandlers() {\n  const cleanup = () => {\n    if (metroProcess) {\n      console.log(\"Cleaning up Metro process...\");\n      metroProcess.kill();\n    }\n    process.exit(0);\n  };\n\n  process.on(\"SIGINT\", cleanup);\n  process.on(\"SIGTERM\", cleanup);\n  process.on(\"SIGHUP\", cleanup);\n}\n\nfunction stripProtocol(domain) {\n  let urlString = domain.trim();\n\n  if (!/^https?:\\/\\//i.test(urlString)) {\n    urlString = `https://${urlString}`;\n  }\n\n  return new URL(urlString).host;\n}\n\nfunction getDeploymentDomain() {\n  // Check Replit deployment environment variables first\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    return stripProtocol(process.env.REPLIT_INTERNAL_APP_DOMAIN);\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    return stripProtocol(process.env.REPLIT_DEV_DOMAIN);\n  }\n\n  if (process.env.EXPO_PUBLIC_DOMAIN) {\n    return stripProtocol(process.env.EXPO_PUBLIC_DOMAIN);\n  }\n\n  console.error(\n    \"ERROR: No deployment domain found. Set REPLIT_INTERNAL_APP_DOMAIN, REPLIT_DEV_DOMAIN, or EXPO_PUBLIC_DOMAIN\",\n  );\n  process.exit(1);\n}\n\nfunction prepareDirectories(timestamp) {\n  console.log(\"Preparing build directories...\");\n\n  if (fs.existsSync(\"static-build\")) {\n    fs.rmSync(\"static-build\", { recursive: true });\n  }\n\n  const dirs = [\n    path.join(\"static-build\", timestamp, \"_expo\", \"static\", \"js\", \"ios\"),\n    path.join(\"static-build\", timestamp, \"_expo\", \"static\", \"js\", \"android\"),\n    path.join(\"static-build\", \"ios\"),\n    path.join(\"static-build\", \"android\"),\n  ];\n\n  for (const dir of dirs) {\n    fs.mkdirSync(dir, { recursive: true });\n  }\n\n  console.log(\"Build:\", timestamp);\n}\n\nfunction clearMetroCache() {\n  console.log(\"Clearing Metro cache...\");\n\n  const cacheDirs = [\n    ...fs.globSync(\".metro-cache\"),\n    ...fs.globSync(\"node_modules/.cache/metro\"),\n  ];\n\n  for (const dir of cacheDirs) {\n    fs.rmSync(dir, { recursive: true, force: true });\n  }\n\n  console.log(\"Cache cleared\");\n}\n\nasync function checkMetroHealth() {\n  try {\n    const response = await fetch(\"http://localhost:8081/status\", {\n      signal: AbortSignal.timeout(5000),\n    });\n    return response.ok;\n  } catch {\n    return false;\n  }\n}\n\nasync function startMetro(expoPublicDomain) {\n  const isRunning = await checkMetroHealth();\n  if (isRunning) {\n    console.log(\"Metro already running\");\n    return;\n  }\n\n  console.log(\"Starting Metro...\");\n  console.log(`Setting EXPO_PUBLIC_DOMAIN=${expoPublicDomain}`);\n  const env = {\n    ...process.env,\n    EXPO_PUBLIC_DOMAIN: expoPublicDomain,\n  };\n  metroProcess = spawn(\"npm\", [\"run\", \"expo:start:static:build\"], {\n    stdio: [\"ignore\", \"pipe\", \"pipe\"],\n    detached: false,\n    env,\n  });\n\n  if (metroProcess.stdout) {\n    metroProcess.stdout.on(\"data\", (data) => {\n      const output = data.toString().trim();\n      if (output) console.log(`[Metro] ${output}`);\n    });\n  }\n  if (metroProcess.stderr) {\n    metroProcess.stderr.on(\"data\", (data) => {\n      const output = data.toString().trim();\n      if (output) console.error(`[Metro Error] ${output}`);\n    });\n  }\n\n  for (let i = 0; i < 60; i++) {\n    await new Promise((resolve) => setTimeout(resolve, 1000));\n\n    const healthy = await checkMetroHealth();\n    if (healthy) {\n      console.log(\"Metro ready\");\n      return;\n    }\n  }\n\n  console.error(\"Metro timeout\");\n  process.exit(1);\n}\n\nasync function downloadFile(url, outputPath) {\n  const controller = new AbortController();\n  const fiveMinMS = 5 * 60 * 1_000;\n  const timeoutId = setTimeout(() => controller.abort(), fiveMinMS);\n\n  try {\n    console.log(`Downloading: ${url}`);\n    const response = await fetch(url, { signal: controller.signal });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const file = fs.createWriteStream(outputPath);\n    await pipeline(Readable.fromWeb(response.body), file);\n\n    const fileSize = fs.statSync(outputPath).size;\n\n    if (fileSize === 0) {\n      fs.unlinkSync(outputPath);\n      throw new Error(\"Downloaded file is empty\");\n    }\n  } catch (error) {\n    if (fs.existsSync(outputPath)) {\n      fs.unlinkSync(outputPath);\n    }\n\n    if (error.name === \"AbortError\") {\n      throw new Error(`Download timeout after 5m: ${url}`);\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\nasync function downloadBundle(platform, timestamp) {\n  // For expo-router apps, the entry is node_modules/expo-router/entry\n  const url = new URL(\"http://localhost:8081/node_modules/expo-router/entry.bundle\");\n  url.searchParams.set(\"platform\", platform);\n  url.searchParams.set(\"dev\", \"false\");\n  url.searchParams.set(\"hot\", \"false\");\n  url.searchParams.set(\"lazy\", \"false\");\n  url.searchParams.set(\"minify\", \"true\");\n\n  const output = path.join(\n    \"static-build\",\n    timestamp,\n    \"_expo\",\n    \"static\",\n    \"js\",\n    platform,\n    \"bundle.js\",\n  );\n\n  console.log(`Fetching ${platform} bundle...`);\n  await downloadFile(url.toString(), output);\n  console.log(`${platform} bundle ready`);\n}\n\nasync function downloadManifest(platform) {\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), 300_000);\n\n  try {\n    console.log(`Fetching ${platform} manifest...`);\n    const response = await fetch(\"http://localhost:8081/manifest\", {\n      headers: { \"expo-platform\": platform },\n      signal: controller.signal,\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n\n    const manifest = await response.json();\n    console.log(`${platform} manifest ready`);\n    return manifest;\n  } catch (error) {\n    if (error.name === \"AbortError\") {\n      throw new Error(\n        `Manifest download timeout after 5m for platform: ${platform}`,\n      );\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeoutId);\n  }\n}\n\nasync function downloadBundlesAndManifests(timestamp) {\n  console.log(\"Downloading bundles and manifests...\");\n  console.log(\"This may take several minutes for production builds...\");\n\n  try {\n    const results = await Promise.allSettled([\n      downloadBundle(\"ios\", timestamp),\n      downloadBundle(\"android\", timestamp),\n      downloadManifest(\"ios\"),\n      downloadManifest(\"android\"),\n    ]);\n\n    const failures = results\n      .map((result, index) => ({ result, index }))\n      .filter(({ result }) => result.status === \"rejected\");\n\n    if (failures.length > 0) {\n      const errorMessages = failures.map(({ result, index }) => {\n        const names = [\n          \"iOS bundle\",\n          \"Android bundle\",\n          \"iOS manifest\",\n          \"Android manifest\",\n        ];\n        return `  - ${names[index]}: ${result.reason?.message || result.reason}`;\n      });\n\n      exitWithError(`Download failed:\\n${errorMessages.join(\"\\n\")}`);\n    }\n\n    const iosManifest =\n      results[2].status === \"fulfilled\" ? results[2].value : null;\n    const androidManifest =\n      results[3].status === \"fulfilled\" ? results[3].value : null;\n\n    console.log(\"All downloads completed successfully\");\n    return { ios: iosManifest, android: androidManifest };\n  } catch (error) {\n    exitWithError(`Unexpected download error: ${error.message}`);\n  }\n}\n\nfunction extractAssets(timestamp) {\n  const bundles = {\n    ios: fs.readFileSync(\n      path.join(\n        \"static-build\",\n        timestamp,\n        \"_expo\",\n        \"static\",\n        \"js\",\n        \"ios\",\n        \"bundle.js\",\n      ),\n      \"utf-8\",\n    ),\n    android: fs.readFileSync(\n      path.join(\n        \"static-build\",\n        timestamp,\n        \"_expo\",\n        \"static\",\n        \"js\",\n        \"android\",\n        \"bundle.js\",\n      ),\n      \"utf-8\",\n    ),\n  };\n\n  const assetsMap = new Map();\n  const assetPattern =\n    /httpServerLocation:\"([^\"]+)\"[^}]*hash:\"([^\"]+)\"[^}]*name:\"([^\"]+)\"[^}]*type:\"([^\"]+)\"/g;\n\n  const extractFromBundle = (bundle, platform) => {\n    for (const match of bundle.matchAll(assetPattern)) {\n      const originalPath = match[1];\n      const filename = match[3] + \".\" + match[4];\n\n      const tempUrl = new URL(`http://localhost:8081${originalPath}`);\n      const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n      if (!unstablePath) {\n        throw new Error(`Asset missing unstable_path: ${originalPath}`);\n      }\n\n      const decodedPath = decodeURIComponent(unstablePath);\n      const key = path.posix.join(decodedPath, filename);\n\n      if (!assetsMap.has(key)) {\n        const asset = {\n          url: path.posix.join(\"/\", decodedPath, filename),\n          originalPath: originalPath,\n          filename: filename,\n          relativePath: decodedPath,\n          hash: match[2],\n          platforms: new Set(),\n        };\n\n        assetsMap.set(key, asset);\n      }\n      assetsMap.get(key).platforms.add(platform);\n    }\n  };\n\n  extractFromBundle(bundles.ios, \"ios\");\n  extractFromBundle(bundles.android, \"android\");\n\n  return Array.from(assetsMap.values());\n}\n\nasync function downloadAssets(assets, timestamp) {\n  if (assets.length === 0) {\n    return 0;\n  }\n\n  console.log(\"Downloading assets...\");\n  let successCount = 0;\n  const failures = [];\n\n  const downloadPromises = assets.map(async (asset) => {\n    const platform = Array.from(asset.platforms)[0];\n\n    const tempUrl = new URL(`http://localhost:8081${asset.originalPath}`);\n    const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n    if (!unstablePath) {\n      throw new Error(`Asset missing unstable_path: ${asset.originalPath}`);\n    }\n\n    const decodedPath = decodeURIComponent(unstablePath);\n    const metroUrl = new URL(\n      `http://localhost:8081${path.posix.join(\"/assets\", decodedPath, asset.filename)}`,\n    );\n    metroUrl.searchParams.set(\"platform\", platform);\n    metroUrl.searchParams.set(\"hash\", asset.hash);\n\n    const outputDir = path.join(\n      \"static-build\",\n      timestamp,\n      \"_expo\",\n      \"static\",\n      \"js\",\n      asset.relativePath,\n    );\n    fs.mkdirSync(outputDir, { recursive: true });\n    const output = path.join(outputDir, asset.filename);\n\n    try {\n      await downloadFile(metroUrl.toString(), output);\n      successCount++;\n    } catch (error) {\n      failures.push({\n        filename: asset.filename,\n        error: error.message,\n        url: metroUrl.toString(),\n      });\n    }\n  });\n\n  await Promise.all(downloadPromises);\n\n  if (failures.length > 0) {\n    const errorMsg =\n      `Failed to download ${failures.length} asset(s):\\n` +\n      failures\n        .map((f) => `  - ${f.filename}: ${f.error} (${f.url})`)\n        .join(\"\\n\");\n    exitWithError(errorMsg);\n  }\n\n  console.log(`Downloaded ${successCount} assets`);\n  return successCount;\n}\n\nfunction updateBundleUrls(timestamp, baseUrl) {\n  const updateForPlatform = (platform) => {\n    const bundlePath = path.join(\n      \"static-build\",\n      timestamp,\n      \"_expo\",\n      \"static\",\n      \"js\",\n      platform,\n      \"bundle.js\",\n    );\n    let bundle = fs.readFileSync(bundlePath, \"utf-8\");\n\n    bundle = bundle.replace(\n      /httpServerLocation:\"(\\/[^\"]+)\"/g,\n      (_match, capturedPath) => {\n        const tempUrl = new URL(`http://localhost:8081${capturedPath}`);\n        const unstablePath = tempUrl.searchParams.get(\"unstable_path\");\n\n        if (!unstablePath) {\n          throw new Error(\n            `Asset missing unstable_path in bundle: ${capturedPath}`,\n          );\n        }\n\n        const decodedPath = decodeURIComponent(unstablePath);\n        return `httpServerLocation:\"${baseUrl}/${timestamp}/_expo/static/js/${decodedPath}\"`;\n      },\n    );\n\n    fs.writeFileSync(bundlePath, bundle);\n  };\n\n  updateForPlatform(\"ios\");\n  updateForPlatform(\"android\");\n  console.log(\"Updated bundle URLs\");\n}\n\nfunction updateManifests(manifests, timestamp, baseUrl, assetsByHash) {\n  const updateForPlatform = (platform, manifest) => {\n    if (!manifest.launchAsset || !manifest.extra) {\n      exitWithError(`Malformed manifest for ${platform}`);\n    }\n\n    manifest.launchAsset.url = `${baseUrl}/${timestamp}/_expo/static/js/${platform}/bundle.js`;\n    manifest.launchAsset.key = `bundle-${timestamp}`;\n    manifest.createdAt = new Date(\n      Number(timestamp.split(\"-\")[0]),\n    ).toISOString();\n    manifest.extra.expoClient.hostUri =\n      baseUrl.replace(\"https://\", \"\") + \"/\" + platform;\n    manifest.extra.expoGo.debuggerHost =\n      baseUrl.replace(\"https://\", \"\") + \"/\" + platform;\n    manifest.extra.expoGo.packagerOpts.dev = false;\n\n    if (manifest.assets && manifest.assets.length > 0) {\n      manifest.assets.forEach((asset) => {\n        if (!asset.url) return;\n\n        const hash = asset.hash;\n        if (!hash) return;\n\n        const assetInfo = assetsByHash.get(hash);\n        if (!assetInfo) return;\n\n        asset.url = `${baseUrl}/${timestamp}/_expo/static/js/${assetInfo.relativePath}/${assetInfo.filename}`;\n      });\n    }\n\n    fs.writeFileSync(\n      path.join(\"static-build\", platform, \"manifest.json\"),\n      JSON.stringify(manifest, null, 2),\n    );\n  };\n\n  updateForPlatform(\"ios\", manifests.ios);\n  updateForPlatform(\"android\", manifests.android);\n  console.log(\"Manifests updated\");\n}\n\nasync function main() {\n  console.log(\"Building static Expo Go deployment...\");\n\n  setupSignalHandlers();\n\n  const domain = getDeploymentDomain();\n  const baseUrl = `https://${domain}`;\n  const timestamp = `${Date.now()}-${process.pid}`;\n\n  prepareDirectories(timestamp);\n  clearMetroCache();\n\n  await startMetro(domain);\n\n  const downloadTimeout = 300000;\n  const downloadPromise = downloadBundlesAndManifests(timestamp);\n  const timeoutPromise = new Promise((_, reject) => {\n    setTimeout(() => {\n      reject(\n        new Error(\n          `Overall download timeout after ${downloadTimeout / 1000} seconds. ` +\n            \"Metro may be struggling to generate bundles. Check Metro logs above.\",\n        ),\n      );\n    }, downloadTimeout);\n  });\n\n  const manifests = await Promise.race([downloadPromise, timeoutPromise]);\n\n  console.log(\"Processing assets...\");\n  const assets = extractAssets(timestamp);\n  console.log(\"Found\", assets.length, \"unique asset(s)\");\n\n  const assetsByHash = new Map();\n  for (const asset of assets) {\n    assetsByHash.set(asset.hash, {\n      relativePath: asset.relativePath,\n      filename: asset.filename,\n    });\n  }\n\n  const assetCount = await downloadAssets(assets, timestamp);\n\n  if (assetCount > 0) {\n    updateBundleUrls(timestamp, baseUrl);\n  }\n\n  console.log(\"Updating manifests and creating landing page...\");\n  updateManifests(manifests, timestamp, baseUrl, assetsByHash);\n\n  console.log(\"Build complete! Deploy to:\", baseUrl);\n\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(0);\n}\n\nmain().catch((error) => {\n  console.error(\"Build failed:\", error.message);\n  if (metroProcess) {\n    metroProcess.kill();\n  }\n  process.exit(1);\n});\n","path":null,"size_bytes":15011,"size_tokens":null},"lib/auth-context.tsx":{"content":"import React, { createContext, useContext, useState, useEffect, useMemo, ReactNode } from \"react\";\nimport { apiRequest, getApiUrl } from \"@/lib/query-client\";\nimport { fetch } from \"expo/fetch\";\n\ninterface UserProfile {\n  id: string;\n  name: string;\n  email: string;\n  role: string;\n  planType: string;\n  linkedMasterId: string | null;\n}\n\ninterface AuthContextValue {\n  user: UserProfile | null;\n  isLoading: boolean;\n  login: (email: string, password: string) => Promise<void>;\n  register: (name: string, email: string, password: string, role: string) => Promise<void>;\n  logout: () => Promise<void>;\n  refreshUser: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextValue | null>(null);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<UserProfile | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const refreshUser = async () => {\n    try {\n      const baseUrl = getApiUrl();\n      const url = new URL(\"/api/auth/me\", baseUrl);\n      const res = await fetch(url.toString(), { credentials: \"include\" });\n      if (res.ok) {\n        const data = await res.json();\n        setUser(data);\n      } else {\n        setUser(null);\n      }\n    } catch {\n      setUser(null);\n    }\n  };\n\n  useEffect(() => {\n    refreshUser().finally(() => setIsLoading(false));\n  }, []);\n\n  const login = async (email: string, password: string) => {\n    const res = await apiRequest(\"POST\", \"/api/auth/login\", { email, password });\n    const data = await res.json();\n    setUser(data);\n  };\n\n  const register = async (name: string, email: string, password: string, role: string) => {\n    const res = await apiRequest(\"POST\", \"/api/auth/register\", { name, email, password, role });\n    const data = await res.json();\n    setUser(data);\n  };\n\n  const logout = async () => {\n    await apiRequest(\"POST\", \"/api/auth/logout\");\n    setUser(null);\n  };\n\n  const value = useMemo(\n    () => ({ user, isLoading, login, register, logout, refreshUser }),\n    [user, isLoading]\n  );\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":2307,"size_tokens":null},"server/index.ts":{"content":"import express from \"express\";\nimport type { Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport * as fs from \"fs\";\nimport * as path from \"path\";\n\nconst app = express();\nconst log = console.log;\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\nfunction setupCors(app: express.Application) {\n  app.use((req, res, next) => {\n    const origins = new Set<string>();\n\n    if (process.env.REPLIT_DEV_DOMAIN) {\n      origins.add(`https://${process.env.REPLIT_DEV_DOMAIN}`);\n    }\n\n    if (process.env.REPLIT_DOMAINS) {\n      process.env.REPLIT_DOMAINS.split(\",\").forEach((d) => {\n        origins.add(`https://${d.trim()}`);\n      });\n    }\n\n    const origin = req.header(\"origin\");\n\n    // Allow localhost origins for Expo web development (any port)\n    const isLocalhost =\n      origin?.startsWith(\"http://localhost:\") ||\n      origin?.startsWith(\"http://127.0.0.1:\");\n\n    if (origin && (origins.has(origin) || isLocalhost)) {\n      res.header(\"Access-Control-Allow-Origin\", origin);\n      res.header(\n        \"Access-Control-Allow-Methods\",\n        \"GET, POST, PUT, PATCH, DELETE, OPTIONS\",\n      );\n      res.header(\"Access-Control-Allow-Headers\", \"Content-Type\");\n      res.header(\"Access-Control-Allow-Credentials\", \"true\");\n    }\n\n    if (req.method === \"OPTIONS\") {\n      return res.sendStatus(200);\n    }\n\n    next();\n  });\n}\n\nfunction setupBodyParsing(app: express.Application) {\n  app.use(\n    express.json({\n      verify: (req, _res, buf) => {\n        req.rawBody = buf;\n      },\n    }),\n  );\n\n  app.use(express.urlencoded({ extended: false }));\n}\n\nfunction setupRequestLogging(app: express.Application) {\n  app.use((req, res, next) => {\n    const start = Date.now();\n    const path = req.path;\n    let capturedJsonResponse: Record<string, unknown> | undefined = undefined;\n\n    const originalResJson = res.json;\n    res.json = function (bodyJson, ...args) {\n      capturedJsonResponse = bodyJson;\n      return originalResJson.apply(res, [bodyJson, ...args]);\n    };\n\n    res.on(\"finish\", () => {\n      if (!path.startsWith(\"/api\")) return;\n\n      const duration = Date.now() - start;\n\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"\";\n      }\n\n      log(logLine);\n    });\n\n    next();\n  });\n}\n\nfunction getAppName(): string {\n  try {\n    const appJsonPath = path.resolve(process.cwd(), \"app.json\");\n    const appJsonContent = fs.readFileSync(appJsonPath, \"utf-8\");\n    const appJson = JSON.parse(appJsonContent);\n    return appJson.expo?.name || \"App Landing Page\";\n  } catch {\n    return \"App Landing Page\";\n  }\n}\n\nfunction serveExpoManifest(platform: string, res: Response) {\n  const manifestPath = path.resolve(\n    process.cwd(),\n    \"static-build\",\n    platform,\n    \"manifest.json\",\n  );\n\n  if (!fs.existsSync(manifestPath)) {\n    return res\n      .status(404)\n      .json({ error: `Manifest not found for platform: ${platform}` });\n  }\n\n  res.setHeader(\"expo-protocol-version\", \"1\");\n  res.setHeader(\"expo-sfv-version\", \"0\");\n  res.setHeader(\"content-type\", \"application/json\");\n\n  const manifest = fs.readFileSync(manifestPath, \"utf-8\");\n  res.send(manifest);\n}\n\nfunction serveLandingPage({\n  req,\n  res,\n  landingPageTemplate,\n  appName,\n}: {\n  req: Request;\n  res: Response;\n  landingPageTemplate: string;\n  appName: string;\n}) {\n  const forwardedProto = req.header(\"x-forwarded-proto\");\n  const protocol = forwardedProto || req.protocol || \"https\";\n  const forwardedHost = req.header(\"x-forwarded-host\");\n  const host = forwardedHost || req.get(\"host\");\n  const baseUrl = `${protocol}://${host}`;\n  const expsUrl = `${host}`;\n\n  log(`baseUrl`, baseUrl);\n  log(`expsUrl`, expsUrl);\n\n  const html = landingPageTemplate\n    .replace(/BASE_URL_PLACEHOLDER/g, baseUrl)\n    .replace(/EXPS_URL_PLACEHOLDER/g, expsUrl)\n    .replace(/APP_NAME_PLACEHOLDER/g, appName);\n\n  res.setHeader(\"Content-Type\", \"text/html; charset=utf-8\");\n  res.status(200).send(html);\n}\n\nfunction configureExpoAndLanding(app: express.Application) {\n  const templatePath = path.resolve(\n    process.cwd(),\n    \"server\",\n    \"templates\",\n    \"landing-page.html\",\n  );\n  const landingPageTemplate = fs.readFileSync(templatePath, \"utf-8\");\n  const appName = getAppName();\n\n  log(\"Serving static Expo files with dynamic manifest routing\");\n\n  app.use((req: Request, res: Response, next: NextFunction) => {\n    if (req.path.startsWith(\"/api\")) {\n      return next();\n    }\n\n    if (req.path !== \"/\" && req.path !== \"/manifest\") {\n      return next();\n    }\n\n    const platform = req.header(\"expo-platform\");\n    if (platform && (platform === \"ios\" || platform === \"android\")) {\n      return serveExpoManifest(platform, res);\n    }\n\n    if (req.path === \"/\") {\n      return serveLandingPage({\n        req,\n        res,\n        landingPageTemplate,\n        appName,\n      });\n    }\n\n    next();\n  });\n\n  app.use(\"/assets\", express.static(path.resolve(process.cwd(), \"assets\")));\n  app.use(express.static(path.resolve(process.cwd(), \"static-build\")));\n\n  log(\"Expo routing: Checking expo-platform header on / and /manifest\");\n}\n\nfunction setupErrorHandler(app: express.Application) {\n  app.use((err: unknown, _req: Request, res: Response, next: NextFunction) => {\n    const error = err as {\n      status?: number;\n      statusCode?: number;\n      message?: string;\n    };\n\n    const status = error.status || error.statusCode || 500;\n    const message = error.message || \"Internal Server Error\";\n\n    console.error(\"Internal Server Error:\", err);\n\n    if (res.headersSent) {\n      return next(err);\n    }\n\n    return res.status(status).json({ message });\n  });\n}\n\n(async () => {\n  setupCors(app);\n  setupBodyParsing(app);\n  setupRequestLogging(app);\n\n  configureExpoAndLanding(app);\n\n  const server = await registerRoutes(app);\n\n  setupErrorHandler(app);\n\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  server.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`express server serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":6260,"size_tokens":null},"app/connections.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  TextInput,\n  Pressable,\n  StyleSheet,\n  Alert,\n  ActivityIndicator,\n  FlatList,\n  Platform,\n  RefreshControl,\n} from \"react-native\";\nimport { router } from \"expo-router\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport * as Haptics from \"expo-haptics\";\nimport Colors from \"@/constants/colors\";\nimport { apiRequest, queryClient } from \"@/lib/query-client\";\nimport { useAuth } from \"@/lib/auth-context\";\nimport { useTheme } from \"@/lib/theme-context\";\n\ninterface Connection {\n  id: string;\n  masterId: string;\n  dependentId: string;\n  status: \"PENDING\" | \"ACCEPTED\";\n  linkedName: string;\n  linkedEmail: string;\n  linkedRole: string;\n}\n\ninterface SearchedUser {\n  id: string;\n  name: string;\n  email: string;\n  role: string;\n}\n\nconst ROLE_LABELS: Record<string, string> = {\n  MASTER: \"Responsavel\",\n  DEPENDENT: \"Dependente\",\n  CONTROLLER: \"Controle\",\n};\n\nfunction ConnectionItem({\n  item,\n  userId,\n  onDelete,\n  onAccept,\n  deletingId,\n  acceptingId,\n  colors,\n}: {\n  item: Connection;\n  userId: string | undefined;\n  onDelete: (id: string) => void;\n  onAccept: (id: string) => void;\n  deletingId: string | null;\n  acceptingId: string | null;\n  colors: typeof Colors.light;\n}) {\n  const isPending = item.status === \"PENDING\";\n  const canAccept = isPending && item.dependentId === userId;\n\n  return (\n    <View style={[styles.connectionCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n      <View style={[styles.connectionAvatar, { backgroundColor: colors.tintLight }]}>\n        <Text style={[styles.connectionAvatarText, { color: colors.tint }]}>\n          {item.linkedName?.charAt(0)?.toUpperCase() || \"?\"}\n        </Text>\n      </View>\n      <View style={styles.connectionInfo}>\n        <Text style={[styles.connectionName, { color: colors.text }]}>{item.linkedName}</Text>\n        <Text style={[styles.connectionEmail, { color: colors.textSecondary }]}>{item.linkedEmail}</Text>\n        <View style={styles.connectionMeta}>\n          <View style={[styles.statusBadge, { backgroundColor: isPending ? colors.warningLight : colors.successLight }]}>\n            <Text style={[styles.statusText, { color: isPending ? colors.warning : colors.success }]}>\n              {isPending ? \"Pendente\" : \"Aceita\"}\n            </Text>\n          </View>\n          <Text style={[styles.roleText, { color: colors.textSecondary }]}>\n            {ROLE_LABELS[item.linkedRole] || item.linkedRole}\n          </Text>\n        </View>\n      </View>\n      <View style={styles.connectionActions}>\n        {canAccept && (\n          <Pressable\n            style={styles.acceptBtn}\n            onPress={() => onAccept(item.id)}\n            disabled={acceptingId === item.id}\n            hitSlop={8}\n          >\n            {acceptingId === item.id ? (\n              <ActivityIndicator size={16} color={colors.success} />\n            ) : (\n              <Ionicons name=\"checkmark-circle\" size={24} color={colors.success} />\n            )}\n          </Pressable>\n        )}\n        <Pressable\n          style={styles.deleteBtn}\n          onPress={() => onDelete(item.id)}\n          disabled={deletingId === item.id}\n          hitSlop={8}\n        >\n          {deletingId === item.id ? (\n            <ActivityIndicator size={16} color={colors.danger} />\n          ) : (\n            <Ionicons name=\"trash-outline\" size={20} color={colors.danger} />\n          )}\n        </Pressable>\n      </View>\n    </View>\n  );\n}\n\nexport default function ConnectionsScreen() {\n  const insets = useSafeAreaInsets();\n  const { user, refreshUser } = useAuth();\n  const { isDark } = useTheme();\n  const colors = isDark ? Colors.dark : Colors.light;\n  const [searchText, setSearchText] = useState(\"\");\n  const [searching, setSearching] = useState(false);\n  const [deletingId, setDeletingId] = useState<string | null>(null);\n  const [acceptingId, setAcceptingId] = useState<string | null>(null);\n\n  const connectionsQuery = useQuery<Connection[]>({\n    queryKey: [\"/api/connections\"],\n  });\n\n  const addMutation = useMutation({\n    mutationFn: async (targetId: string) => {\n      const res = await apiRequest(\"POST\", \"/api/connections\", { targetId });\n      return res.json();\n    },\n    onSuccess: () => {\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      queryClient.invalidateQueries({ queryKey: [\"/api/connections\"] });\n      setSearchText(\"\");\n    },\n    onError: (err: any) => {\n      const msg = err.message || \"\";\n      if (msg.includes(\"403\") && msg.includes(\"requiresUpgrade\")) {\n        showUpgradeDialog();\n      } else {\n        try {\n          const parsed = JSON.parse(msg.split(\": \").slice(1).join(\": \"));\n          if (parsed.requiresUpgrade) {\n            showUpgradeDialog();\n            return;\n          }\n        } catch {}\n        Alert.alert(\"Erro\", \"Nao foi possivel criar a conexao.\");\n      }\n    },\n  });\n\n  const showUpgradeDialog = () => {\n    Alert.alert(\n      \"Limite do Plano Free\",\n      \"Voce atingiu o limite de conexoes do plano gratuito. Faca upgrade para Premium para conexoes ilimitadas.\",\n      [\n        { text: \"Cancelar\", style: \"cancel\" },\n        {\n          text: \"Fazer Upgrade\",\n          onPress: async () => {\n            try {\n              await apiRequest(\"POST\", \"/api/auth/upgrade\");\n              await refreshUser();\n              Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n              Alert.alert(\"Sucesso\", \"Plano atualizado para Premium!\");\n            } catch (e: any) {\n              Alert.alert(\"Erro\", e.message || \"Nao foi possivel realizar o upgrade.\");\n            }\n          },\n        },\n      ]\n    );\n  };\n\n  const handleSearch = async () => {\n    const identifier = searchText.trim();\n    if (!identifier) {\n      Alert.alert(\"Erro\", \"Informe um ID ou email para buscar.\");\n      return;\n    }\n    setSearching(true);\n    try {\n      const res = await apiRequest(\"GET\", `/api/users/search/${encodeURIComponent(identifier)}`);\n      const foundUser: SearchedUser = await res.json();\n\n      Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n\n      Alert.alert(\n        \"Conectar\",\n        `Deseja conectar-se com ${foundUser.name}?\\n\\nFuncao: ${ROLE_LABELS[foundUser.role] || foundUser.role}\\nEmail: ${foundUser.email}`,\n        [\n          { text: \"Cancelar\", style: \"cancel\" },\n          {\n            text: \"Conectar\",\n            onPress: () => addMutation.mutate(foundUser.id),\n          },\n        ]\n      );\n    } catch (err: any) {\n      const msg = err.message || \"\";\n      if (msg.includes(\"404\")) {\n        Alert.alert(\"Nao encontrado\", \"Nenhum usuario encontrado com esse ID ou email.\");\n      } else {\n        Alert.alert(\"Erro\", \"Nao foi possivel buscar o usuario.\");\n      }\n    } finally {\n      setSearching(false);\n    }\n  };\n\n  const handleDelete = (connectionId: string) => {\n    Alert.alert(\n      \"Remover Conexao\",\n      \"Deseja realmente remover esta conexao?\",\n      [\n        { text: \"Cancelar\", style: \"cancel\" },\n        {\n          text: \"Remover\",\n          style: \"destructive\",\n          onPress: async () => {\n            setDeletingId(connectionId);\n            try {\n              await apiRequest(\"DELETE\", `/api/connections/${connectionId}`);\n              Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n              queryClient.invalidateQueries({ queryKey: [\"/api/connections\"] });\n            } catch (e: any) {\n              Alert.alert(\"Erro\", e.message || \"Nao foi possivel remover a conexao.\");\n            } finally {\n              setDeletingId(null);\n            }\n          },\n        },\n      ]\n    );\n  };\n\n  const handleAccept = (connectionId: string) => {\n    Alert.alert(\n      \"Aceitar Conexao\",\n      \"Deseja aceitar esta conexao?\",\n      [\n        { text: \"Cancelar\", style: \"cancel\" },\n        {\n          text: \"Aceitar\",\n          onPress: async () => {\n            setAcceptingId(connectionId);\n            try {\n              await apiRequest(\"PATCH\", `/api/connections/${connectionId}/accept`);\n              Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n              queryClient.invalidateQueries({ queryKey: [\"/api/connections\"] });\n            } catch (e: any) {\n              Alert.alert(\"Erro\", e.message || \"Nao foi possivel aceitar a conexao.\");\n            } finally {\n              setAcceptingId(null);\n            }\n          },\n        },\n      ]\n    );\n  };\n\n  const connections = connectionsQuery.data || [];\n\n  const renderItem = ({ item }: { item: Connection }) => (\n    <ConnectionItem\n      item={item}\n      userId={user?.id}\n      onDelete={handleDelete}\n      onAccept={handleAccept}\n      deletingId={deletingId}\n      acceptingId={acceptingId}\n      colors={colors}\n    />\n  );\n\n  const renderEmpty = () => {\n    if (connectionsQuery.isLoading) return null;\n    return (\n      <View style={styles.emptyContainer}>\n        <View style={[styles.emptyIcon, { backgroundColor: colors.inputBg }]}>\n          <Ionicons name=\"people-outline\" size={40} color={colors.textSecondary} />\n        </View>\n        <Text style={[styles.emptyTitle, { color: colors.text }]}>Nenhuma conexao</Text>\n        <Text style={[styles.emptySubtitle, { color: colors.textSecondary }]}>\n          Busque por ID ou email para adicionar uma conexao\n        </Text>\n      </View>\n    );\n  };\n\n  return (\n    <View style={[styles.container, { backgroundColor: colors.background }]}>\n      <View style={[styles.header, { paddingTop: insets.top + (Platform.OS === \"web\" ? 67 : 0) + 8, backgroundColor: colors.surface, borderBottomColor: colors.border }]}>\n        <View style={styles.headerRow}>\n          <Pressable onPress={() => router.back()} hitSlop={12} style={[styles.backBtn, { backgroundColor: colors.inputBg }]}>\n            <Ionicons name=\"arrow-back\" size={24} color={colors.text} />\n          </Pressable>\n          <Text style={[styles.headerTitle, { color: colors.text }]}>Conexoes</Text>\n          <View style={{ width: 36 }} />\n        </View>\n      </View>\n\n      <View style={[styles.searchSection, { backgroundColor: colors.surface, borderBottomColor: colors.border }]}>\n        <View style={styles.searchRow}>\n          <View style={[styles.searchInputWrapper, { backgroundColor: colors.inputBg }]}>\n            <Ionicons name=\"search\" size={18} color={colors.textSecondary} />\n            <TextInput\n              style={[styles.searchInput, { color: colors.text }]}\n              placeholder=\"Buscar por ID ou email...\"\n              placeholderTextColor={colors.textSecondary}\n              value={searchText}\n              onChangeText={setSearchText}\n              autoCapitalize=\"none\"\n              autoCorrect={false}\n              returnKeyType=\"search\"\n              onSubmitEditing={handleSearch}\n              editable={!searching && !addMutation.isPending}\n            />\n          </View>\n          <Pressable\n            style={({ pressed }) => [\n              styles.searchBtn,\n              { backgroundColor: colors.tint },\n              pressed && { opacity: 0.85 },\n              (searching || addMutation.isPending) && { opacity: 0.6 },\n            ]}\n            onPress={handleSearch}\n            disabled={searching || addMutation.isPending}\n          >\n            {searching || addMutation.isPending ? (\n              <ActivityIndicator size={18} color=\"#fff\" />\n            ) : (\n              <Ionicons name=\"person-add\" size={18} color=\"#fff\" />\n            )}\n          </Pressable>\n        </View>\n      </View>\n\n      <FlatList\n        data={connections}\n        keyExtractor={(item) => item.id}\n        renderItem={renderItem}\n        ListEmptyComponent={renderEmpty}\n        contentContainerStyle={[\n          styles.listContent,\n          { paddingBottom: insets.bottom + (Platform.OS === \"web\" ? 34 : 0) + 24 },\n          connections.length === 0 && { flex: 1 },\n        ]}\n        showsVerticalScrollIndicator={false}\n        refreshControl={\n          <RefreshControl\n            refreshing={connectionsQuery.isRefetching}\n            onRefresh={() => connectionsQuery.refetch()}\n            tintColor={colors.tint}\n            colors={[colors.tint]}\n          />\n        }\n        ListHeaderComponent={\n          connectionsQuery.isLoading ? (\n            <View style={styles.loadingContainer}>\n              <ActivityIndicator size=\"large\" color={colors.tint} />\n              <Text style={[styles.loadingText, { color: colors.textSecondary }]}>Carregando conexoes...</Text>\n            </View>\n          ) : connections.length > 0 ? (\n            <Text style={[styles.sectionLabel, { color: colors.textSecondary }]}>\n              {connections.length} {connections.length === 1 ? \"conexao\" : \"conexoes\"}\n            </Text>\n          ) : null\n        }\n      />\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  header: {\n    paddingHorizontal: 20,\n    paddingBottom: 12,\n    borderBottomWidth: 1,\n  },\n  headerRow: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n  },\n  backBtn: {\n    width: 36,\n    height: 36,\n    borderRadius: 12,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  headerTitle: {\n    fontSize: 18,\n    fontFamily: \"Inter_700Bold\",\n  },\n  searchSection: {\n    paddingHorizontal: 20,\n    paddingVertical: 14,\n    borderBottomWidth: 1,\n  },\n  searchRow: {\n    flexDirection: \"row\",\n    gap: 10,\n  },\n  searchInputWrapper: {\n    flex: 1,\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderRadius: 14,\n    paddingHorizontal: 14,\n    height: 48,\n    gap: 10,\n  },\n  searchInput: {\n    flex: 1,\n    fontSize: 15,\n    fontFamily: \"Inter_400Regular\",\n  },\n  searchBtn: {\n    width: 48,\n    height: 48,\n    borderRadius: 14,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  listContent: {\n    padding: 20,\n  },\n  sectionLabel: {\n    fontSize: 13,\n    fontFamily: \"Inter_600SemiBold\",\n    textTransform: \"uppercase\" as const,\n    letterSpacing: 0.5,\n    marginBottom: 12,\n    paddingLeft: 4,\n  },\n  connectionCard: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderRadius: 16,\n    padding: 14,\n    marginBottom: 10,\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 1,\n    shadowRadius: 8,\n    elevation: 2,\n    gap: 12,\n  },\n  connectionAvatar: {\n    width: 44,\n    height: 44,\n    borderRadius: 14,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  connectionAvatarText: {\n    fontSize: 18,\n    fontFamily: \"Inter_700Bold\",\n  },\n  connectionInfo: {\n    flex: 1,\n  },\n  connectionName: {\n    fontSize: 15,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  connectionEmail: {\n    fontSize: 12,\n    fontFamily: \"Inter_400Regular\",\n    marginTop: 1,\n  },\n  connectionMeta: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: 8,\n    marginTop: 6,\n  },\n  statusBadge: {\n    borderRadius: 6,\n    paddingHorizontal: 8,\n    paddingVertical: 2,\n  },\n  statusText: {\n    fontSize: 10,\n    fontFamily: \"Inter_700Bold\",\n  },\n  roleText: {\n    fontSize: 11,\n    fontFamily: \"Inter_400Regular\",\n  },\n  connectionActions: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: 4,\n  },\n  acceptBtn: {\n    width: 36,\n    height: 36,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  deleteBtn: {\n    width: 36,\n    height: 36,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  emptyContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: 40,\n  },\n  emptyIcon: {\n    width: 80,\n    height: 80,\n    borderRadius: 24,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    marginBottom: 16,\n  },\n  emptyTitle: {\n    fontSize: 18,\n    fontFamily: \"Inter_700Bold\",\n    marginBottom: 6,\n  },\n  emptySubtitle: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n    textAlign: \"center\",\n    lineHeight: 20,\n  },\n  loadingContainer: {\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingVertical: 40,\n    gap: 12,\n  },\n  loadingText: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n  },\n});\n","path":null,"size_bytes":16236,"size_tokens":null},"app/+not-found.tsx":{"content":"// template\nimport { Link, Stack } from \"expo-router\";\nimport { StyleSheet, Text, View } from \"react-native\";\n\nexport default function NotFoundScreen() {\n  return (\n    <>\n      <Stack.Screen options={{ title: \"Oops!\" }} />\n      <View style={styles.container}>\n        <Text style={styles.title}>This screen doesn&apos;t exist.</Text>\n\n        <Link href=\"/\" style={styles.link}>\n          <Text style={styles.linkText}>Go to home screen!</Text>\n        </Link>\n      </View>\n    </>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    padding: 20,\n  },\n  title: {\n    fontSize: 20,\n    fontWeight: \"bold\",\n  },\n  link: {\n    marginTop: 15,\n    paddingVertical: 15,\n  },\n  linkText: {\n    fontSize: 14,\n    color: \"#2e78b7\",\n  },\n});\n","path":null,"size_bytes":814,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, bigint, timestamp } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\")\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  role: text(\"role\").notNull().default(\"MASTER\"),\n  planType: text(\"plan_type\").notNull().default(\"FREE\"),\n  linkedMasterId: text(\"linked_master_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const medications = pgTable(\"medications\", {\n  id: varchar(\"id\")\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  dosage: text(\"dosage\").notNull(),\n  currentStock: integer(\"current_stock\").notNull().default(0),\n  alertThreshold: integer(\"alert_threshold\").notNull().default(5),\n  intervalInHours: integer(\"interval_in_hours\").notNull().default(8),\n  ownerId: text(\"owner_id\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const doseSchedules = pgTable(\"dose_schedules\", {\n  id: varchar(\"id\")\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  medId: text(\"med_id\").notNull(),\n  timeMillis: bigint(\"time_millis\", { mode: \"number\" }).notNull(),\n  status: text(\"status\").notNull().default(\"PENDING\"),\n  confirmedAt: bigint(\"confirmed_at\", { mode: \"number\" }),\n  ownerId: text(\"owner_id\").notNull(),\n});\n\nexport const connections = pgTable(\"connections\", {\n  id: varchar(\"id\")\n    .primaryKey()\n    .default(sql`gen_random_uuid()`),\n  masterId: text(\"master_id\").notNull(),\n  dependentId: text(\"dependent_id\").notNull(),\n  status: text(\"status\").notNull().default(\"PENDING\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  name: true,\n  email: true,\n  password: true,\n  role: true,\n});\n\nexport const loginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n});\n\nexport const updateProfileSchema = z.object({\n  name: z.string().min(1).optional(),\n  email: z.string().email().optional(),\n});\n\nexport const updateRoleSchema = z.object({\n  role: z.enum([\"MASTER\", \"DEPENDENT\", \"CONTROLLER\"]),\n});\n\nexport const insertMedicationSchema = createInsertSchema(medications).pick({\n  name: true,\n  dosage: true,\n  currentStock: true,\n  alertThreshold: true,\n  intervalInHours: true,\n});\n\nexport const updateMedicationSchema = z.object({\n  name: z.string().min(1).optional(),\n  dosage: z.string().min(1).optional(),\n  currentStock: z.number().min(0).optional(),\n  alertThreshold: z.number().min(0).optional(),\n  intervalInHours: z.number().min(1).optional(),\n});\n\nexport const insertConnectionSchema = z.object({\n  targetId: z.string().min(1),\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type Medication = typeof medications.$inferSelect;\nexport type InsertMedication = z.infer<typeof insertMedicationSchema>;\nexport type DoseSchedule = typeof doseSchedules.$inferSelect;\nexport type Connection = typeof connections.$inferSelect;\n","path":null,"size_bytes":3213,"size_tokens":null},"app/(tabs)/medications.tsx":{"content":"import React, { useState } from \"react\";\nimport {\n  View,\n  Text,\n  StyleSheet,\n  FlatList,\n  Pressable,\n  ActivityIndicator,\n  Alert,\n  RefreshControl,\n  Platform,\n} from \"react-native\";\nimport { useSafeAreaInsets } from \"react-native-safe-area-context\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Ionicons } from \"@expo/vector-icons\";\nimport { router } from \"expo-router\";\nimport * as Haptics from \"expo-haptics\";\nimport Colors from \"@/constants/colors\";\nimport { apiRequest, queryClient } from \"@/lib/query-client\";\nimport { useTheme } from \"@/lib/theme-context\";\n\ninterface Medication {\n  id: string;\n  name: string;\n  dosage: string;\n  currentStock: number;\n  alertThreshold: number;\n  intervalInHours: number;\n  ownerId: string;\n}\n\ninterface HistoryEntry {\n  id: string;\n  medId: string;\n  timeMillis: number;\n  status: string;\n  confirmedAt: string;\n  medicationName: string;\n  medicationDosage: string;\n}\n\nfunction MedicationDetailCard({ med, onDelete, onEdit, colors }: { med: Medication; onDelete: (id: string) => void; onEdit: (id: string) => void; colors: typeof Colors.light }) {\n  const isLowStock = med.currentStock <= med.alertThreshold;\n  const isOutOfStock = med.currentStock === 0;\n  const stockPercentage = med.alertThreshold > 0\n    ? Math.min((med.currentStock / (med.alertThreshold * 3)) * 100, 100)\n    : 100;\n\n  return (\n    <Pressable\n      onPress={() => {\n        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n        onEdit(med.id);\n      }}\n      style={({ pressed }) => [styles.detailCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }, pressed && { opacity: 0.9 }]}\n    >\n      <View style={styles.detailHeader}>\n        <View style={[styles.medIcon, { backgroundColor: colors.tintLight }, isOutOfStock && { backgroundColor: colors.dangerLight }, isLowStock && !isOutOfStock && { backgroundColor: colors.warningLight }]}>\n          <Ionicons\n            name=\"medical\"\n            size={22}\n            color={isOutOfStock ? colors.danger : isLowStock ? colors.warning : colors.tint}\n          />\n        </View>\n        <View style={styles.detailInfo}>\n          <Text style={[styles.detailName, { color: colors.text }]}>{med.name}</Text>\n          <Text style={[styles.detailDosage, { color: colors.textSecondary }]}>{med.dosage}</Text>\n        </View>\n        <Pressable\n          onPress={() => {\n            Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n            Alert.alert(\n              \"Remover\",\n              `Deseja remover ${med.name}?`,\n              [\n                { text: \"Cancelar\", style: \"cancel\" },\n                { text: \"Remover\", style: \"destructive\", onPress: () => onDelete(med.id) },\n              ]\n            );\n          }}\n        >\n          <Ionicons name=\"trash-outline\" size={20} color={colors.danger} />\n        </Pressable>\n      </View>\n\n      <View style={styles.detailStats}>\n        <View style={styles.detailStat}>\n          <Ionicons name=\"time-outline\" size={16} color={colors.textSecondary} />\n          <Text style={[styles.detailStatText, { color: colors.textSecondary }]}>A cada {med.intervalInHours}h</Text>\n        </View>\n        <View style={styles.detailStat}>\n          <Ionicons name=\"cube-outline\" size={16} color={colors.textSecondary} />\n          <Text style={[styles.detailStatText, { color: colors.textSecondary }]}>{med.currentStock} unidades</Text>\n        </View>\n        <View style={styles.detailStat}>\n          <Ionicons name=\"notifications-outline\" size={16} color={colors.textSecondary} />\n          <Text style={[styles.detailStatText, { color: colors.textSecondary }]}>Alerta: {med.alertThreshold} un.</Text>\n        </View>\n      </View>\n\n      <View style={styles.stockBarContainer}>\n        <View style={[styles.stockBarBg, { backgroundColor: colors.inputBg }]}>\n          <View\n            style={[\n              styles.stockBarFill,\n              {\n                width: `${stockPercentage}%`,\n                backgroundColor: isOutOfStock\n                  ? colors.danger\n                  : isLowStock\n                  ? colors.warning\n                  : colors.success,\n              },\n            ]}\n          />\n        </View>\n        <Text style={[styles.stockLabel, { color: colors.success }, isLowStock && { color: colors.warning }]}>\n          {isOutOfStock ? \"Sem estoque\" : isLowStock ? \"Estoque baixo\" : \"Estoque adequado\"}\n        </Text>\n      </View>\n    </Pressable>\n  );\n}\n\nfunction HistoryItem({ entry, colors }: { entry: HistoryEntry; colors: typeof Colors.light }) {\n  const confirmedDate = entry.confirmedAt ? new Date(entry.confirmedAt) : new Date(entry.timeMillis);\n  const formattedDate = confirmedDate.toLocaleDateString(\"pt-BR\", {\n    day: \"2-digit\",\n    month: \"2-digit\",\n    year: \"numeric\",\n  });\n  const formattedTime = confirmedDate.toLocaleTimeString(\"pt-BR\", {\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  });\n\n  return (\n    <View style={[styles.historyCard, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]}>\n      <View style={[styles.historyIcon, { backgroundColor: colors.successLight }]}>\n        <Ionicons name=\"checkmark-circle\" size={22} color={colors.success} />\n      </View>\n      <View style={styles.historyInfo}>\n        <Text style={[styles.historyName, { color: colors.text }]}>{entry.medicationName}</Text>\n        <Text style={[styles.historyDosage, { color: colors.textSecondary }]}>{entry.medicationDosage}</Text>\n      </View>\n      <View style={styles.historyTime}>\n        <Text style={[styles.historyDate, { color: colors.textSecondary }]}>{formattedDate}</Text>\n        <Text style={[styles.historyHour, { color: colors.text }]}>{formattedTime}</Text>\n      </View>\n    </View>\n  );\n}\n\nexport default function MedicationsScreen() {\n  const insets = useSafeAreaInsets();\n  const [activeTab, setActiveTab] = useState<\"remedios\" | \"historico\">(\"remedios\");\n  const { isDark } = useTheme();\n  const colors = isDark ? Colors.dark : Colors.light;\n\n  const medsQuery = useQuery<Medication[]>({\n    queryKey: [\"/api/medications\"],\n  });\n\n  const historyQuery = useQuery<HistoryEntry[]>({\n    queryKey: [\"/api/schedules/history\"],\n    enabled: activeTab === \"historico\",\n    staleTime: 0,\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/medications/${id}`);\n    },\n    onSuccess: () => {\n      Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n      queryClient.invalidateQueries({ queryKey: [\"/api/medications\"] });\n    },\n  });\n\n  const medications = medsQuery.data || [];\n  const history = historyQuery.data || [];\n\n  return (\n    <View style={[styles.container, { backgroundColor: colors.background }]}>\n      <View style={[styles.header, { paddingTop: insets.top + (Platform.OS === \"web\" ? 67 : 0) + 8, backgroundColor: colors.surface, borderBottomColor: colors.border }]}>\n        <Text style={[styles.headerTitle, { color: colors.text }]}>Medicamentos</Text>\n        <Pressable\n          style={({ pressed }) => [styles.addBtn, { backgroundColor: colors.tintLight }, pressed && { opacity: 0.7 }]}\n          onPress={() => router.push(\"/add-medication\")}\n        >\n          <Ionicons name=\"add\" size={24} color={colors.tint} />\n        </Pressable>\n      </View>\n\n      <View style={[styles.segmentContainer, { backgroundColor: colors.surface }]}>\n        <View style={[styles.segmentControl, { backgroundColor: colors.inputBg }]}>\n          <Pressable\n            style={[styles.segmentBtn, activeTab === \"remedios\" && [styles.segmentBtnActive, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]]}\n            onPress={() => {\n              Haptics.selectionAsync();\n              setActiveTab(\"remedios\");\n            }}\n          >\n            <Text style={[styles.segmentText, { color: colors.textSecondary }, activeTab === \"remedios\" && [styles.segmentTextActive, { color: colors.text }]]}>\n              Remedios\n            </Text>\n          </Pressable>\n          <Pressable\n            style={[styles.segmentBtn, activeTab === \"historico\" && [styles.segmentBtnActive, { backgroundColor: colors.surface, shadowColor: colors.cardShadow }]]}\n            onPress={() => {\n              Haptics.selectionAsync();\n              setActiveTab(\"historico\");\n            }}\n          >\n            <Text style={[styles.segmentText, { color: colors.textSecondary }, activeTab === \"historico\" && [styles.segmentTextActive, { color: colors.text }]]}>\n              Historico\n            </Text>\n          </Pressable>\n        </View>\n      </View>\n\n      {activeTab === \"remedios\" ? (\n        <>\n          {medsQuery.isLoading ? (\n            <View style={styles.loadingContainer}>\n              <ActivityIndicator size=\"large\" color={colors.tint} />\n            </View>\n          ) : medications.length === 0 ? (\n            <View style={styles.emptyContainer}>\n              <Ionicons name=\"medkit-outline\" size={56} color={colors.border} />\n              <Text style={[styles.emptyTitle, { color: colors.text }]}>Lista vazia</Text>\n              <Text style={[styles.emptyText, { color: colors.textSecondary }]}>Cadastre seus medicamentos para acompanhar estoque e horarios</Text>\n            </View>\n          ) : (\n            <FlatList\n              data={medications}\n              keyExtractor={(item) => item.id}\n              renderItem={({ item }) => (\n                <MedicationDetailCard\n                  med={item}\n                  colors={colors}\n                  onDelete={(id) => deleteMutation.mutate(id)}\n                  onEdit={(id) => router.push(`/edit-medication?id=${id}`)}\n                />\n              )}\n              contentContainerStyle={styles.listContent}\n              showsVerticalScrollIndicator={false}\n              refreshControl={\n                <RefreshControl\n                  refreshing={medsQuery.isFetching}\n                  onRefresh={() => medsQuery.refetch()}\n                  tintColor={colors.tint}\n                />\n              }\n            />\n          )}\n        </>\n      ) : (\n        <>\n          {historyQuery.isLoading ? (\n            <View style={styles.loadingContainer}>\n              <ActivityIndicator size=\"large\" color={colors.tint} />\n            </View>\n          ) : history.length === 0 ? (\n            <View style={styles.emptyContainer}>\n              <Ionicons name=\"time-outline\" size={56} color={colors.border} />\n              <Text style={[styles.emptyTitle, { color: colors.text }]}>Nenhuma dose registrada</Text>\n              <Text style={[styles.emptyText, { color: colors.textSecondary }]}>O historico de doses confirmadas aparecera aqui</Text>\n            </View>\n          ) : (\n            <FlatList\n              data={history}\n              keyExtractor={(item) => item.id}\n              renderItem={({ item }) => <HistoryItem entry={item} colors={colors} />}\n              contentContainerStyle={styles.listContent}\n              showsVerticalScrollIndicator={false}\n              refreshControl={\n                <RefreshControl\n                  refreshing={historyQuery.isFetching}\n                  onRefresh={() => historyQuery.refetch()}\n                  tintColor={colors.tint}\n                />\n              }\n            />\n          )}\n        </>\n      )}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  header: {\n    flexDirection: \"row\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    paddingHorizontal: 20,\n    paddingBottom: 12,\n    borderBottomWidth: 1,\n  },\n  headerTitle: {\n    fontSize: 28,\n    fontFamily: \"Inter_700Bold\",\n  },\n  addBtn: {\n    width: 40,\n    height: 40,\n    borderRadius: 12,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  segmentContainer: {\n    paddingHorizontal: 20,\n    paddingVertical: 12,\n  },\n  segmentControl: {\n    flexDirection: \"row\",\n    borderRadius: 12,\n    padding: 3,\n  },\n  segmentBtn: {\n    flex: 1,\n    height: 38,\n    borderRadius: 10,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  segmentBtnActive: {\n    shadowOffset: { width: 0, height: 1 },\n    shadowOpacity: 1,\n    shadowRadius: 3,\n    elevation: 2,\n  },\n  segmentText: {\n    fontSize: 14,\n    fontFamily: \"Inter_500Medium\",\n  },\n  segmentTextActive: {\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  listContent: {\n    padding: 20,\n    paddingBottom: 100,\n    gap: 14,\n  },\n  detailCard: {\n    borderRadius: 18,\n    padding: 16,\n    shadowOffset: { width: 0, height: 2 },\n    shadowOpacity: 1,\n    shadowRadius: 8,\n    elevation: 2,\n  },\n  detailHeader: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: 12,\n  },\n  medIcon: {\n    width: 44,\n    height: 44,\n    borderRadius: 13,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  detailInfo: {\n    flex: 1,\n  },\n  detailName: {\n    fontSize: 16,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  detailDosage: {\n    fontSize: 13,\n    fontFamily: \"Inter_400Regular\",\n    marginTop: 1,\n  },\n  detailStats: {\n    flexDirection: \"row\",\n    marginTop: 14,\n    gap: 16,\n  },\n  detailStat: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    gap: 4,\n  },\n  detailStatText: {\n    fontSize: 12,\n    fontFamily: \"Inter_500Medium\",\n  },\n  stockBarContainer: {\n    marginTop: 14,\n  },\n  stockBarBg: {\n    height: 6,\n    borderRadius: 3,\n    overflow: \"hidden\",\n  },\n  stockBarFill: {\n    height: \"100%\",\n    borderRadius: 3,\n  },\n  stockLabel: {\n    fontSize: 11,\n    fontFamily: \"Inter_500Medium\",\n    marginTop: 6,\n  },\n  loadingContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  emptyContainer: {\n    flex: 1,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    paddingHorizontal: 40,\n    gap: 8,\n  },\n  emptyTitle: {\n    fontSize: 17,\n    fontFamily: \"Inter_600SemiBold\",\n    marginTop: 8,\n  },\n  emptyText: {\n    fontSize: 14,\n    fontFamily: \"Inter_400Regular\",\n    textAlign: \"center\" as const,\n  },\n  historyCard: {\n    flexDirection: \"row\",\n    alignItems: \"center\",\n    borderRadius: 14,\n    padding: 14,\n    gap: 12,\n    shadowOffset: { width: 0, height: 1 },\n    shadowOpacity: 1,\n    shadowRadius: 4,\n    elevation: 1,\n  },\n  historyIcon: {\n    width: 40,\n    height: 40,\n    borderRadius: 12,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  historyInfo: {\n    flex: 1,\n  },\n  historyName: {\n    fontSize: 15,\n    fontFamily: \"Inter_600SemiBold\",\n  },\n  historyDosage: {\n    fontSize: 13,\n    fontFamily: \"Inter_400Regular\",\n    marginTop: 1,\n  },\n  historyTime: {\n    alignItems: \"flex-end\",\n  },\n  historyDate: {\n    fontSize: 12,\n    fontFamily: \"Inter_500Medium\",\n  },\n  historyHour: {\n    fontSize: 13,\n    fontFamily: \"Inter_600SemiBold\",\n    marginTop: 2,\n  },\n});\n","path":null,"size_bytes":14800,"size_tokens":null},"server/storage.ts":{"content":"import {\n  type User,\n  type InsertUser,\n  type Medication,\n  type InsertMedication,\n  type DoseSchedule,\n  type Connection,\n  users,\n  medications,\n  doseSchedules,\n  connections,\n} from \"@shared/schema\";\nimport { drizzle } from \"drizzle-orm/neon-serverless\";\nimport { eq, and, desc } from \"drizzle-orm\";\nimport ws from \"ws\";\nimport { Pool, neonConfig } from \"@neondatabase/serverless\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL must be set.\");\n}\n\nconst pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool);\n\nexport interface IStorage {\n  createUser(user: InsertUser & { password: string }): Promise<User>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getUserById(id: string): Promise<User | undefined>;\n  updateUser(id: string, data: Partial<Pick<User, \"name\" | \"email\" | \"role\" | \"planType\">>): Promise<User>;\n  getMedicationsByOwner(ownerId: string): Promise<Medication[]>;\n  getMedicationById(id: string): Promise<Medication | undefined>;\n  createMedication(med: InsertMedication & { ownerId: string }): Promise<Medication>;\n  updateMedication(id: string, ownerId: string, data: Partial<Pick<Medication, \"name\" | \"dosage\" | \"currentStock\" | \"alertThreshold\" | \"intervalInHours\">>): Promise<Medication>;\n  deleteMedication(id: string, ownerId: string): Promise<void>;\n  updateMedicationStock(id: string, newStock: number): Promise<void>;\n  getSchedulesByOwner(ownerId: string): Promise<DoseSchedule[]>;\n  getConfirmedSchedulesByOwner(ownerId: string): Promise<DoseSchedule[]>;\n  createSchedule(schedule: Omit<DoseSchedule, \"id\">): Promise<DoseSchedule>;\n  updateScheduleStatus(id: string, status: string, confirmedAt?: number): Promise<void>;\n  createConnection(masterId: string, dependentId: string): Promise<Connection>;\n  getConnectionsByMaster(masterId: string): Promise<Connection[]>;\n  getConnectionsByDependent(dependentId: string): Promise<Connection[]>;\n  getConnectionCount(masterId: string): Promise<number>;\n  acceptConnection(id: string): Promise<void>;\n  deleteConnection(id: string): Promise<void>;\n  getDependentsForMaster(masterId: string): Promise<User[]>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async createUser(user: InsertUser & { password: string }): Promise<User> {\n    const [created] = await db.insert(users).values(user).returning();\n    return created;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async getUserById(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async updateUser(id: string, data: Partial<Pick<User, \"name\" | \"email\" | \"role\" | \"planType\">>): Promise<User> {\n    const [updated] = await db.update(users).set(data).where(eq(users.id, id)).returning();\n    return updated;\n  }\n\n  async getMedicationsByOwner(ownerId: string): Promise<Medication[]> {\n    return db.select().from(medications).where(eq(medications.ownerId, ownerId));\n  }\n\n  async getMedicationById(id: string): Promise<Medication | undefined> {\n    const [med] = await db.select().from(medications).where(eq(medications.id, id));\n    return med;\n  }\n\n  async createMedication(med: InsertMedication & { ownerId: string }): Promise<Medication> {\n    const [created] = await db.insert(medications).values(med).returning();\n    return created;\n  }\n\n  async updateMedication(id: string, ownerId: string, data: Partial<Pick<Medication, \"name\" | \"dosage\" | \"currentStock\" | \"alertThreshold\" | \"intervalInHours\">>): Promise<Medication> {\n    const [updated] = await db.update(medications).set(data).where(and(eq(medications.id, id), eq(medications.ownerId, ownerId))).returning();\n    return updated;\n  }\n\n  async deleteMedication(id: string, ownerId: string): Promise<void> {\n    await db.delete(medications).where(and(eq(medications.id, id), eq(medications.ownerId, ownerId)));\n  }\n\n  async updateMedicationStock(id: string, newStock: number): Promise<void> {\n    await db.update(medications).set({ currentStock: newStock }).where(eq(medications.id, id));\n  }\n\n  async getSchedulesByOwner(ownerId: string): Promise<DoseSchedule[]> {\n    return db.select().from(doseSchedules).where(eq(doseSchedules.ownerId, ownerId));\n  }\n\n  async getConfirmedSchedulesByOwner(ownerId: string): Promise<DoseSchedule[]> {\n    return db.select().from(doseSchedules)\n      .where(and(eq(doseSchedules.ownerId, ownerId), eq(doseSchedules.status, \"TAKEN\")))\n      .orderBy(desc(doseSchedules.confirmedAt));\n  }\n\n  async createSchedule(schedule: Omit<DoseSchedule, \"id\">): Promise<DoseSchedule> {\n    const [created] = await db.insert(doseSchedules).values(schedule).returning();\n    return created;\n  }\n\n  async updateScheduleStatus(id: string, status: string, confirmedAt?: number): Promise<void> {\n    await db.update(doseSchedules).set({ status, confirmedAt: confirmedAt ?? null }).where(eq(doseSchedules.id, id));\n  }\n\n  async createConnection(masterId: string, dependentId: string): Promise<Connection> {\n    const [created] = await db.insert(connections).values({ masterId, dependentId }).returning();\n    return created;\n  }\n\n  async getConnectionsByMaster(masterId: string): Promise<Connection[]> {\n    return db.select().from(connections).where(eq(connections.masterId, masterId));\n  }\n\n  async getConnectionsByDependent(dependentId: string): Promise<Connection[]> {\n    return db.select().from(connections).where(eq(connections.dependentId, dependentId));\n  }\n\n  async getConnectionCount(masterId: string): Promise<number> {\n    const conns = await db.select().from(connections).where(eq(connections.masterId, masterId));\n    return conns.length;\n  }\n\n  async acceptConnection(id: string): Promise<void> {\n    await db.update(connections).set({ status: \"ACCEPTED\" }).where(eq(connections.id, id));\n  }\n\n  async deleteConnection(id: string): Promise<void> {\n    await db.delete(connections).where(eq(connections.id, id));\n  }\n\n  async getSchedulesByOwnerWithStatus(ownerId: string, statuses: string[]): Promise<DoseSchedule[]> {\n    const allSchedules = await db.select().from(doseSchedules).where(eq(doseSchedules.ownerId, ownerId)).orderBy(desc(doseSchedules.timeMillis));\n    return allSchedules.filter(s => statuses.includes(s.status));\n  }\n\n  async getDependentsForMaster(masterId: string): Promise<User[]> {\n    const conns = await this.getConnectionsByMaster(masterId);\n    const acceptedConns = conns.filter(c => c.status === \"ACCEPTED\");\n    const dependents: User[] = [];\n    for (const conn of acceptedConns) {\n      const user = await this.getUserById(conn.dependentId);\n      if (user) dependents.push(user);\n    }\n    return dependents;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":6861,"size_tokens":null},"eslint.config.js":{"content":"const { defineConfig } = require('eslint/config');\nconst expoConfig = require('eslint-config-expo/flat');\n\nmodule.exports = defineConfig([\n  expoConfig,\n  {\n    ignores: [\"dist/*\"],\n  }\n]);\n","path":null,"size_bytes":190,"size_tokens":null},"components/KeyboardAwareScrollViewCompat.tsx":{"content":"// template\nimport { Platform, ScrollView, ScrollViewProps } from \"react-native\";\nimport {\n  KeyboardAwareScrollView,\n  KeyboardAwareScrollViewProps,\n} from \"react-native-keyboard-controller\";\n\ntype Props = KeyboardAwareScrollViewProps & ScrollViewProps;\n\nexport function KeyboardAwareScrollViewCompat({\n  children,\n  keyboardShouldPersistTaps = \"handled\",\n  ...props\n}: Props) {\n  if (Platform.OS === \"web\") {\n    return (\n      <ScrollView keyboardShouldPersistTaps={keyboardShouldPersistTaps} {...props}>\n        {children}\n      </ScrollView>\n    );\n  }\n  return (\n    <KeyboardAwareScrollView\n      keyboardShouldPersistTaps={keyboardShouldPersistTaps}\n      {...props}\n    >\n      {children}\n    </KeyboardAwareScrollView>\n  );\n}\n","path":null,"size_bytes":736,"size_tokens":null},"replit.md":{"content":"# MedControl\n\n## Overview\nMedControl is a medication management mobile app built with Expo (React Native) and Express backend. It helps dependents take medications on time and allows a \"Master\" (responsible person) and \"Control Contacts\" to be notified if a dose is missed or stock runs out.\n\n## Recent Changes\n- 2026-02-15: Added profile editing, UID copy, role switcher, connections management, premium upgrade flow, medication editing, and dose history tab\n- 2026-02-15: Initial project setup with auth, medications CRUD, dashboard, and profile screens\n\n## Architecture\n- **Frontend**: Expo Router (file-based routing), React Native, TypeScript\n- **Backend**: Express.js with TypeScript\n- **Database**: PostgreSQL (Neon) with Drizzle ORM\n- **Auth**: Session-based (express-session + connect-pg-simple)\n- **State**: React Query for server state, React Context for auth\n\n## Data Models\n- **users**: id, name, email, password, role (MASTER/DEPENDENT/CONTROLLER), planType (FREE/PREMIUM), linkedMasterId\n- **medications**: id, name, dosage, currentStock, alertThreshold, intervalInHours, ownerId\n- **dose_schedules**: id, medId, timeMillis, status (PENDING/TAKEN/MISSED), confirmedAt, ownerId\n- **connections**: id, masterId, dependentId, status (PENDING/ACCEPTED)\n\n## Key Routes\n- POST /api/auth/register - Register new user\n- POST /api/auth/login - Login\n- GET /api/auth/me - Current user\n- PATCH /api/auth/profile - Update profile (name, email)\n- PATCH /api/auth/role - Change user role\n- POST /api/auth/upgrade - Upgrade to PREMIUM plan (mock Stripe)\n- GET /api/users/search/:identifier - Search user by ID or email\n- GET/POST /api/medications - List/Create medications\n- GET /api/medications/:id - Get single medication\n- PATCH /api/medications/:id - Edit medication\n- DELETE /api/medications/:id - Delete medication\n- PATCH /api/medications/:id/stock - Update stock\n- GET/POST /api/schedules - List/Create dose schedules\n- GET /api/schedules/history - Get confirmed doses (reverse chronological)\n- PATCH /api/schedules/:id/confirm - Confirm dose taken\n- POST /api/medications/:id/take-dose - Single-call dose confirm (creates TAKEN schedule, decrements stock)\n- GET /api/dependents - List dependents with summary stats (MASTER only)\n- GET /api/dependents/:id/history - Dependent dose history with med names (MASTER only)\n- GET /api/dependents/:id/medications - Dependent medications (MASTER only)\n- GET/POST /api/connections - List/Create user connections\n- DELETE /api/connections/:id - Remove connection\n- PATCH /api/connections/:id/accept - Accept pending connection\n\n## Screens\n- **Login** (/login): Email/password login\n- **Register** (/register): Name, email, password, role selector\n- **Dashboard** (/(tabs)/index): Greeting, stats, medication list with dose confirm\n- **Medications** (/(tabs)/medications): Segmented control (Remedios/Historico), medication cards, dose history\n- **Profile** (/(tabs)/profile): Edit profile, copy UID, role switcher, plan upgrade, connections link\n- **Connections** (/connections): Search/validate users, add/delete/accept connections\n- **Add Medication** (/add-medication): Modal form to create medication\n- **Edit Medication** (/edit-medication?id=xxx): Modal form to edit medication\n\n## Connection Logic\n- FREE plan: Max 1 dependent per Master\n- PREMIUM plan: Unlimited dependents\n\n## User Preferences\n- Language: Portuguese (Brazilian)\n- No XML, only Jetpack Compose style (adapted to React Native)\n- camelCase variable naming\n","path":null,"size_bytes":3477,"size_tokens":null}},"version":2}